{% extends "base.html" %}
{% block title %}Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ â€” Ø¨Ø§Ø´Ú¯Ø§Ù‡ ÙÙˆØªØ³Ø§Ù„{% endblock %}
{% block nav_dashboard %}active{% endblock %}

{% block breadcrumb %}
  <span class="cur">Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</span>
{% endblock %}

{% block content %}

{% if user.is_technical_director %}
{# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù…Ø¯ÛŒØ± ÙÙ†ÛŒ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• #}
<div class="page-header">
  <div>
    <h1>ğŸ‘‹ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ØŒ {{ user.get_full_name|default:user.username }}</h1>
    <p>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù…Ø¯ÛŒØ±ÛŒØª ÙÙ†ÛŒ Ø¨Ø§Ø´Ú¯Ø§Ù‡ ÙÙˆØªØ³Ø§Ù„</p>
  </div>
</div>

<div class="grid-auto" style="margin-bottom:1.5rem">
  <div class="stat-card green">
    <div class="stat-label">Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† ÙØ¹Ø§Ù„</div>
    <div class="stat-value">{{ total_players|default:0 }}</div>
    <span class="stat-icon">âš½</span>
  </div>
  <div class="stat-card amber">
    <div class="stat-label">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ£ÛŒÛŒØ¯</div>
    <div class="stat-value">{{ pending_players|default:0 }}</div>
    <span class="stat-icon">â³</span>
  </div>
  <div class="stat-card navy">
    <div class="stat-label">Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§ÛŒ Ø¢Ù…ÙˆØ²Ø´ÛŒ</div>
    <div class="stat-value">{{ total_categories|default:0 }}</div>
    <span class="stat-icon">ğŸ“š</span>
  </div>
  <div class="stat-card teal">
    <div class="stat-label">Ø¢Ø±Ø´ÛŒÙˆâ€ŒØ´Ø¯Ù‡</div>
    <div class="stat-value">{{ archived_players|default:0 }}</div>
    <span class="stat-icon">ğŸ—„ï¸</span>
  </div>
</div>

{% if pending_players > 0 %}
<div class="alert alert-warning mb-2">
  <span class="alert-icon">â³</span>
  <div>
    <strong>{{ pending_players }} Ù…ØªÙ‚Ø§Ø¶ÛŒ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø±Ø±Ø³ÛŒ</strong>
    <div style="margin-top:.25rem">
      <a href="{% url 'registration:applicant-list' %}" class="btn btn-amber btn-sm">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ùˆ Ø¨Ø±Ø±Ø³ÛŒ â†’</a>
    </div>
  </div>
</div>
{% endif %}

<div style="display:flex;gap:.5rem;flex-wrap:wrap;margin-bottom:1.25rem">
  <a href="{% url 'training:player-list' %}" class="btn btn-navy btn-sm">ğŸ‘¥ Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù†</a>
  <a href="{% url 'training:attendance-select' %}" class="btn btn-teal btn-sm">ğŸ“… Ø«Ø¨Øª Ø­Ø¶ÙˆØ±</a>
  <a href="{% url 'training:organize' %}" class="btn btn-outline btn-sm">ğŸ”€ Ø³Ø§Ø²Ù…Ø§Ù†Ø¯Ù‡ÛŒ</a>
  <a href="{% url 'training:stats' %}" class="btn btn-outline btn-sm">ğŸ“Š Ø¢Ù…Ø§Ø±</a>
  <a href="{% url 'comms:announcement-create' %}" class="btn btn-outline btn-sm">ğŸ“£ Ø§Ø·Ù„Ø§Ø¹ÛŒÙ‡</a>
</div>

{% if age_category_stats %}
<div class="card" style="margin-bottom:1rem">
  <div class="card-header">
    <span class="card-title">ğŸ§’ ØªÙˆØ²ÛŒØ¹ Ø±Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø³Ù†ÛŒ</span>
    <a href="{% url 'training:stats' %}" class="btn btn-outline btn-sm">Ø¬Ø²Ø¦ÛŒØ§Øª â†</a>
  </div>
  <div style="padding:.75rem 1rem">
    {% for cat, cnt, pct in age_category_stats %}
    <div style="display:flex;align-items:center;gap:.6rem;margin-bottom:.45rem">
      <span style="min-width:80px;font-size:.8rem;font-weight:700;color:var(--navy);text-align:right">{{ cat }}</span>
      <div style="flex:1;height:20px;background:var(--surface-2);border-radius:99px;overflow:hidden">
        <div style="height:100%;background:var(--teal);border-radius:99px;width:{{ pct|default:1 }}%;display:flex;align-items:center;justify-content:flex-end;padding-left:.4rem">
          <span style="font-size:.65rem;font-weight:800;color:#fff">{{ cnt }}</span>
        </div>
      </div>
      <span style="font-size:.8rem;font-weight:700;min-width:30px;color:var(--text-muted)">{{ cnt }}</span>
    </div>
    {% endfor %}
  </div>
</div>
{% endif %}

{% if recent_players %}
<div class="card" style="margin-bottom:1rem">
  <div class="card-header">
    <span class="card-title">Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø´Ø¯Ù‡</span>
    <a href="{% url 'registration:applicant-list' %}" class="btn btn-outline btn-sm">Ù‡Ù…Ù‡ â†</a>
  </div>
  <div class="table-wrap">
    <table class="data-table">
      <thead><tr><th>Ù†Ø§Ù…</th><th>Ú©Ø¯Ù…Ù„ÛŒ</th><th>ÙˆØ¶Ø¹ÛŒØª</th><th>ØªØ§Ø±ÛŒØ®</th></tr></thead>
      <tbody>
        {% for p in recent_players %}
        <tr>
          <td><strong>{{ p.first_name }} {{ p.last_name }}</strong></td>
          <td style="font-family:monospace;font-size:.82rem">{{ p.national_id }}</td>
          <td>
            {% if p.status == 'pending' %}<span class="badge badge-amber">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</span>
            {% elif p.status == 'approved' %}<span class="badge badge-green">ØªØ£ÛŒÛŒØ¯</span>
            {% else %}<span class="badge badge-red">Ø±Ø¯</span>{% endif %}
          </td>
          <td style="font-size:.82rem;color:var(--text-muted)">{{ p.registration_date|date:"Y/m/d" }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endif %}

{% if recent_changes %}
<div class="card" style="margin-bottom:1rem">
  <div class="card-header">
    <span class="card-title">ğŸ”” ØªØºÛŒÛŒØ±Ø§Øª Ø§Ø®ÛŒØ± Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù†</span>
  </div>
  <div style="padding:.5rem .85rem">
    {% for log in recent_changes %}
    <div style="display:flex;align-items:flex-start;gap:.65rem;padding:.55rem 0;border-bottom:1px solid var(--surface-2)">
      <div style="width:32px;height:32px;border-radius:50%;background:rgba(14,165,233,.12);display:flex;align-items:center;justify-content:center;font-size:.85rem;flex-shrink:0">
        {% if log.action == 'insurance_updated' %}ğŸ›¡ï¸
        {% elif log.action == 'tech_updated' %}âš½
        {% elif log.action == 'traits_updated' %}ğŸ§ 
        {% elif log.action == 'category_changed' %}ğŸ”€
        {% elif log.action == 'profile_updated' %}âœï¸
        {% elif log.action == 'archived' %}ğŸ“¦
        {% elif log.action == 'restored' %}â™»ï¸
        {% else %}ğŸ“{% endif %}
      </div>
      <div style="flex:1;min-width:0">
        <div style="font-size:.82rem;font-weight:700;color:var(--navy)">
          {{ log.player.first_name }} {{ log.player.last_name }}
          <span style="font-weight:400;color:var(--text-muted)">â€” {{ log.get_action_display }}</span>
        </div>
        {% if log.detail %}
        <div style="font-size:.75rem;color:var(--text-muted);margin-top:.1rem">{{ log.detail }}</div>
        {% endif %}
        <div style="font-size:.7rem;color:var(--text-light);margin-top:.1rem">
          {% if log.actor %}{{ log.actor.first_name }} {{ log.actor.last_name }} Â· {% endif %}{{ log.created_at|date:"Y/m/d H:i" }}
        </div>
      </div>
      <a href="{% url 'training:player-profile' log.player.pk %}" class="btn btn-outline btn-sm" style="flex-shrink:0">Ù¾Ø±ÙˆÙØ§ÛŒÙ„</a>
    </div>
    {% endfor %}
  </div>
</div>
{% endif %}

{% if unread_notifications %}
<div class="card" style="margin-bottom:1rem">
  <div class="card-header">
    <span class="card-title">ğŸ“¬ Ø§Ø¹Ù„Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯</span>
    <span style="background:var(--red);color:#fff;border-radius:99px;padding:.15rem .55rem;font-size:.72rem;font-weight:800">
      {{ unread_notifications|length }}
    </span>
  </div>
  <div style="padding:.6rem .85rem">
    {% for notif in unread_notifications %}
    <div style="display:flex;gap:.6rem;padding:.5rem 0;border-bottom:1px solid var(--surface-2);align-items:flex-start">
      <span style="font-size:1rem">
        {% if notif.type == 'insurance_expiry' %}âš ï¸{% else %}ğŸ””{% endif %}
      </span>
      <div style="flex:1">
        <div style="font-size:.82rem;font-weight:700">{{ notif.title }}</div>
        <div style="font-size:.75rem;color:var(--text-muted);margin-top:.1rem">{{ notif.message|truncatechars:80 }}</div>
      </div>
    </div>
    {% endfor %}
  </div>
</div>
{% endif %}


{% elif user.is_finance_manager %}
{# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù…Ø§Ù„ÛŒ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• #}
<div class="page-header">
  <div>
    <h1>ğŸ’° Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù…Ø§Ù„ÛŒ</h1>
    <p>Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ {{ user.get_full_name|default:user.username }}</p>
  </div>
  <a href="{% url 'payroll:finance-dashboard' %}" class="btn btn-primary">Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù…Ø§Ù„ÛŒ Ú©Ø§Ù…Ù„ â†’</a>
</div>

<div class="grid-auto" style="margin-bottom:1.5rem">
  <div class="stat-card amber">
    <div class="stat-label">ÙØ§Ú©ØªÙˆØ± Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</div>
    <div class="stat-value">{{ pending_invoices|default:0 }}</div>
    <span class="stat-icon">ğŸ§¾</span>
  </div>
  <div class="stat-card red">
    <div class="stat-label">Ø¨Ø¯Ù‡Ú©Ø§Ø±Ø§Ù†</div>
    <div class="stat-value">{{ total_debt|default:0 }}</div>
    <span class="stat-icon">âš ï¸</span>
  </div>
  <div class="stat-card teal">
    <div class="stat-label">Ø­Ù‚ÙˆÙ‚ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</div>
    <div class="stat-value">{{ pending_salaries|default:0 }}</div>
    <span class="stat-icon">ğŸ’³</span>
  </div>
</div>


{% elif user.is_coach %}
{# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù…Ø±Ø¨ÛŒ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• #}
<div class="page-header">
  <div>
    <h1>ğŸ¯ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù…Ø±Ø¨ÛŒ</h1>
    <p>Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ {{ user.get_full_name|default:user.username }}</p>
  </div>
</div>

<div class="grid-auto" style="margin-bottom:1.5rem">
  <div class="stat-card green">
    <div class="stat-label">Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† ØªØ­Øª Ù†Ø¸Ø±</div>
    <div class="stat-value">{{ total_players_coached|default:0 }}</div>
    <span class="stat-icon">âš½</span>
  </div>
  <div class="stat-card navy">
    <div class="stat-label">Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§ÛŒ Ù…Ù†</div>
    <div class="stat-value">{{ my_categories.count|default:0 }}</div>
    <span class="stat-icon">ğŸ“š</span>
  </div>
</div>

<div style="display:flex;gap:.75rem;flex-wrap:wrap">
  <a href="{% url 'training:attendance-select' %}" class="btn btn-primary">ğŸ“‹ Ø«Ø¨Øª Ø­Ø¶ÙˆØ±</a>
  <a href="{% url 'exercises:gallery' %}" class="btn btn-amber">ğŸ¯ Ù…Ø®Ø²Ù† ØªÙ…Ø±ÛŒÙ†â€ŒÙ‡Ø§</a>
  <a href="{% url 'comms:announcement-list' %}" class="btn btn-outline">ğŸ“¢ Ø§Ø¹Ù„Ø§Ù†Ø§Øª</a>
</div>

{% if recent_changes %}
<div class="card" style="margin-top:1rem">
  <div class="card-header"><span class="card-title">ğŸ”” ØªØºÛŒÛŒØ±Ø§Øª Ø§Ø®ÛŒØ± Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† Ù…Ù†</span></div>
  <div style="padding:.5rem .85rem">
    {% for log in recent_changes %}
    <div style="display:flex;align-items:center;gap:.6rem;padding:.5rem 0;border-bottom:1px solid var(--surface-2)">
      <span style="font-size:1rem">
        {% if log.action == 'insurance_updated' %}ğŸ›¡ï¸
        {% elif log.action == 'tech_updated' %}âš½
        {% elif log.action == 'profile_updated' %}âœï¸
        {% else %}ğŸ“{% endif %}
      </span>
      <div style="flex:1">
        <span style="font-size:.82rem;font-weight:700">{{ log.player.first_name }} {{ log.player.last_name }}</span>
        <span style="font-size:.78rem;color:var(--text-muted)"> â€” {{ log.get_action_display }}</span>
        {% if log.detail %}<div style="font-size:.72rem;color:var(--text-muted)">{{ log.detail }}</div>{% endif %}
      </div>
      <span style="font-size:.7rem;color:var(--text-light)">{{ log.created_at|date:"m/d H:i" }}</span>
      <a href="{% url 'training:player-profile' log.player.pk %}" class="btn btn-outline btn-sm">â†’</a>
    </div>
    {% endfor %}
  </div>
</div>
{% endif %}

{% if unread_notifications %}
<div class="card" style="margin-top:.75rem">
  <div class="card-header">
    <span class="card-title">ğŸ“¬ Ø§Ø¹Ù„Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯</span>
    <span style="background:var(--red);color:#fff;border-radius:99px;padding:.15rem .55rem;font-size:.72rem;font-weight:800">{{ unread_notifications|length }}</span>
  </div>
  <div style="padding:.6rem .85rem">
    {% for notif in unread_notifications %}
    <div style="padding:.45rem 0;border-bottom:1px solid var(--surface-2);font-size:.82rem">
      <div style="font-weight:700">{{ notif.title }}</div>
      <div style="font-size:.75rem;color:var(--text-muted);margin-top:.15rem">{{ notif.message|truncatechars:80 }}</div>
    </div>
    {% endfor %}
  </div>
</div>
{% endif %}


{% elif user.is_player %}
{# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø¨Ø§Ø²ÛŒÚ©Ù† â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• #}
<div class="page-header">
  <div>
    <h1>âš½ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ØŒ {{ user.first_name }}</h1>
    <p>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø´Ø®ØµÛŒ Ø´Ù…Ø§</p>
  </div>
</div>

{% if my_pending_invoices > 0 %}
<div class="alert alert-warning mb-2">
  <span class="alert-icon">ğŸ§¾</span>
  <div>
    <strong>{{ my_pending_invoices }} ÙØ§Ú©ØªÙˆØ± Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ†Ø´Ø¯Ù‡ Ø¯Ø§Ø±ÛŒØ¯</strong>
    <div style="margin-top:.25rem">
      <a href="{% url 'payroll:player-invoices' %}" class="btn btn-amber btn-sm">Ù…Ø´Ø§Ù‡Ø¯Ù‡ ÙØ§Ú©ØªÙˆØ±Ù‡Ø§</a>
    </div>
  </div>
</div>
{% endif %}

{% if my_schedules %}
<div class="card mb-2">
  <div class="card-header">
    <span class="card-title">ğŸ—“ï¸ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù‡ÙØªÚ¯ÛŒ ØªÙ…Ø±ÛŒÙ†</span>
  </div>
  <div class="table-wrap">
    <table class="data-table">
      <thead>
        <tr>
          <th>Ø±ÙˆØ²</th>
          <th>Ø³Ø§Ø¹Øª Ø´Ø±ÙˆØ¹</th>
          <th>Ø³Ø§Ø¹Øª Ù¾Ø§ÛŒØ§Ù†</th>
          <th>Ù…Ú©Ø§Ù† / Ø³Ø§Ù„Ù†</th>
          <th>Ø¯Ø³ØªÙ‡ Ø¢Ù…ÙˆØ²Ø´ÛŒ</th>
        </tr>
      </thead>
      <tbody>
        {% for sch in my_schedules %}
        <tr>
          <td><strong>{{ sch.get_weekday_display }}</strong></td>
          <td style="font-family:monospace">{{ sch.start_time|time:"H:i" }}</td>
          <td style="font-family:monospace">
            {% if sch.end_time %}{{ sch.end_time|time:"H:i" }}{% else %}<span style="color:var(--text-light)">â€”</span>{% endif %}
          </td>
          <td>{% if sch.location %}<span style="font-size:.82rem">ğŸ“ {{ sch.location }}</span>{% else %}<span style="color:var(--text-light)">â€”</span>{% endif %}</td>
          <td><span class="badge badge-navy">{{ sch.category.name }}</span></td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endif %}

<div style="display:flex;gap:.75rem;flex-wrap:wrap">
  <a href="{% url 'comms:notification-list' %}" class="btn btn-outline">ğŸ”” Ø§Ø¹Ù„Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ù…Ù†</a>
  <a href="{% url 'comms:announcement-list' %}" class="btn btn-outline">ğŸ“¢ Ø§Ø·Ù„Ø§Ø¹ÛŒÙ‡â€ŒÙ‡Ø§</a>
</div>


{% else %}
{# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• Ù…ØªÙ‚Ø§Ø¶ÛŒ Ø¬Ø¯ÛŒØ¯ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• #}
<div style="text-align:center;padding:3rem">
  <div style="font-size:3rem;margin-bottom:1rem">â³</div>
  <h2>Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø´Ù…Ø§ Ø¯Ø± Ø¯Ø³Øª Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø³Øª</h2>
  <p style="color:var(--text-muted);margin-top:.75rem">
    Ù…Ø¯ÛŒØ± ÙÙ†ÛŒ Ø¨Ø§Ø´Ú¯Ø§Ù‡ Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ Ù¾Ø±ÙˆÙ†Ø¯Ù‡ Ø´Ù…Ø§ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ø®ÙˆØ§Ù‡Ø¯ Ú©Ø±Ø¯.
  </p>
</div>
{% endif %}

{% endblock %}