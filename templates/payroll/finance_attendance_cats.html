{% extends "base.html" %}
{% block title %}Ø­Ø¶ÙˆØ± Ùˆ ØºÛŒØ§Ø¨ Ø±Ø¯Ù‡â€ŒÙ‡Ø§{% endblock %}
{% block nav_finance %}active{% endblock %}

{% block breadcrumb %}
  <span class="sep">â€º</span>
  <a href="{% url 'payroll:finance-dashboard' %}" style="text-decoration:none;color:inherit">Ù…Ø§Ù„ÛŒ</a>
  <span class="sep">â€º</span><span class="cur">Ø­Ø¶ÙˆØ± Ùˆ ØºÛŒØ§Ø¨</span>
{% endblock %}

{% block content %}
<div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:.75rem;margin-bottom:1.25rem">
  <div>
    <h1 style="font-size:1.1rem;font-weight:900;color:var(--navy)">ğŸ“‹ Ø­Ø¶ÙˆØ± Ùˆ ØºÛŒØ§Ø¨ Ø±Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¢Ù…ÙˆØ²Ø´ÛŒ</h1>
    <p style="font-size:.82rem;color:var(--text-muted)">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù…Ø§ØªØ±ÛŒØ³ Ø­Ø¶ÙˆØ± + ÙˆØ¶Ø¹ÛŒØª Ø´Ù‡Ø±ÛŒÙ‡ â€” ÙÙ‚Ø·â€ŒØ®ÙˆØ§Ù†Ø¯Ù†ÛŒ</p>
  </div>
  <div style="display:flex;gap:.4rem;align-items:center">
    <a href="?year={{ prev_month.year }}&month={{ prev_month.month }}" class="btn btn-outline btn-sm">â† Ù‚Ø¨Ù„</a>
    <span style="font-weight:800;font-size:.9rem;background:var(--surface-1);padding:.3rem .75rem;border-radius:8px">
      {{ month.year }}/{% if month.month < 10 %}0{% endif %}{{ month.month }}
    </span>
    <a href="?year={{ next_month.year }}&month={{ next_month.month }}" class="btn btn-outline btn-sm">Ø¨Ø¹Ø¯ â†’</a>
  </div>
</div>

<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:1rem">
  {% for item in categories %}
  <div style="background:#fff;border:1.5px solid var(--surface-2);border-radius:12px;overflow:hidden">
    <!-- Ù†ÙˆØ§Ø± Ø¨Ø§Ù„Ø§ â€” Ø±Ù†Ú¯â€ŒØ¨Ù†Ø¯ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ ÙˆØ¶Ø¹ÛŒØª -->
    <div style="height:4px;background:{% if item.has_sheet %}{% if item.paid_count == item.invoice_count and item.invoice_count > 0 %}var(--green){% elif item.pending_count > 0 %}#f59e0b{% else %}var(--teal){% endif %}{% else %}var(--surface-2){% endif %}"></div>
    <div style="padding:1rem">
      <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:.65rem">
        <div>
          <div style="font-weight:900;font-size:.92rem;color:var(--navy)">{{ item.category.name }}</div>
          <div style="font-size:.72rem;color:var(--text-muted)">{{ item.player_count }} Ø¨Ø§Ø²ÛŒÚ©Ù†</div>
        </div>
        {% if item.has_sheet %}
        <span style="background:#dbeafe;color:#1e3a8a;border-radius:6px;font-size:.68rem;padding:.2rem .5rem;font-weight:700">
          {{ item.session_count }} Ø¬Ù„Ø³Ù‡
        </span>
        {% else %}
        <span style="background:var(--surface-2);color:var(--text-muted);border-radius:6px;font-size:.68rem;padding:.2rem .5rem">
          Ø¨Ø¯ÙˆÙ† Ø¬Ù„Ø³Ù‡
        </span>
        {% endif %}
      </div>

      <!-- Ø¢Ù…Ø§Ø± Ø´Ù‡Ø±ÛŒÙ‡ -->
      {% if item.invoice_count > 0 %}
      <div style="display:flex;gap:.5rem;margin-bottom:.75rem">
        <div style="flex:1;text-align:center;background:#f0fdf4;border-radius:6px;padding:.35rem">
          <div style="font-weight:900;color:var(--green);font-size:.9rem">{{ item.paid_count }}</div>
          <div style="font-size:.62rem;color:var(--text-muted)">Ù¾Ø±Ø¯Ø§Ø®Øª</div>
        </div>
        <div style="flex:1;text-align:center;background:#fffbeb;border-radius:6px;padding:.35rem">
          <div style="font-weight:900;color:#d97706;font-size:.9rem">{{ item.pending_count }}</div>
          <div style="font-size:.62rem;color:var(--text-muted)">Ù…Ø¹ÙˆÙ‚</div>
        </div>
        <div style="flex:1;text-align:center;background:#f1f5f9;border-radius:6px;padding:.35rem">
          <div style="font-weight:900;color:var(--text-muted);font-size:.9rem">{{ item.invoice_count }}</div>
          <div style="font-size:.62rem;color:var(--text-muted)">Ú©Ù„</div>
        </div>
      </div>
      {% else %}
      <div style="font-size:.75rem;color:var(--text-muted);margin-bottom:.75rem">ÙØ§Ú©ØªÙˆØ± Ø´Ù‡Ø±ÛŒÙ‡â€ŒØ§ÛŒ ØµØ§Ø¯Ø± Ù†Ø´Ø¯Ù‡</div>
      {% endif %}

      <div style="display:flex;gap:.4rem">
        <a href="{% url 'payroll:finance-attendance-sheet' item.category.pk %}?year={{ month.year }}&month={{ month.month }}"
           class="btn btn-navy btn-sm" style="flex:1;text-align:center;font-size:.78rem">
          ğŸ“‹ Ø­Ø¶ÙˆØ± + Ø´Ù‡Ø±ÛŒÙ‡
        </a>
        <a href="{% url 'payroll:invoice-list' item.category.pk %}?year={{ month.year }}&month={{ month.month }}"
           class="btn btn-outline btn-sm" style="font-size:.78rem">ğŸ§¾</a>
      </div>
    </div>
  </div>
  {% empty %}
  <div style="grid-column:1/-1;text-align:center;padding:3rem;color:var(--text-muted)">
    <div style="font-size:2.5rem;margin-bottom:.75rem">ğŸ“‹</div>
    <p style="font-weight:700">Ù‡ÛŒÚ† Ø¯Ø³ØªÙ‡ Ø¢Ù…ÙˆØ²Ø´ÛŒ ÙØ¹Ø§Ù„ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</p>
  </div>
  {% endfor %}
</div>
{% endblock %}