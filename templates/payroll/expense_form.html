{% extends "base.html" %}
{% block title %}Ø«Ø¨Øª ØªØ±Ø§Ú©Ù†Ø´ Ù…Ø§Ù„ÛŒ{% endblock %}
{% block nav_expenses %}active{% endblock %}

{% block breadcrumb %}
  <span class="sep">â€º</span>
  <a href="{% url 'payroll:expense-list' %}" style="text-decoration:none;color:inherit">Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§</a>
  <span class="sep">â€º</span><span class="cur">ØªØ±Ø§Ú©Ù†Ø´ Ø¬Ø¯ÛŒØ¯</span>
{% endblock %}

{% block content %}
<div style="max-width:600px;margin:0 auto">
  <div class="card" style="padding:0;overflow:hidden">
    <div style="height:4px;background:linear-gradient(90deg,var(--red),var(--amber))"></div>
    <div style="padding:1.5rem 1.75rem">

      <div style="display:flex;align-items:center;gap:.75rem;margin-bottom:1.5rem">
        <div style="width:42px;height:42px;background:linear-gradient(135deg,#ef4444,#f59e0b);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.2rem">ğŸ“Š</div>
        <div>
          <h1 style="font-size:1.1rem;font-weight:900;color:var(--navy)">Ø«Ø¨Øª ØªØ±Ø§Ú©Ù†Ø´ Ù…Ø§Ù„ÛŒ Ø¬Ø¯ÛŒØ¯</h1>
          <p style="font-size:.78rem;color:var(--text-muted)">Ù‡Ø²ÛŒÙ†Ù‡ ÛŒØ§ Ø¯Ø±Ø¢Ù…Ø¯ Ø¨Ø§Ø´Ú¯Ø§Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯</p>
        </div>
      </div>

      {% if not has_categories %}
      <div style="background:#fffbeb;border:1.5px solid #fde68a;border-radius:10px;padding:.85rem 1rem;margin-bottom:1.25rem;font-size:.85rem;color:#92400e;display:flex;align-items:center;justify-content:space-between;gap:.75rem;flex-wrap:wrap">
        <span>âš ï¸ Ù‡Ù†ÙˆØ² Ù‡ÛŒÚ† Ø¯Ø³ØªÙ‡ Ù…Ø§Ù„ÛŒ ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</span>
        <a href="{% url 'payroll:expense-category-create' %}" class="btn btn-amber btn-sm">
          â• Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø³ØªÙ‡ Ø¬Ø¯ÛŒØ¯
        </a>
      </div>
      {% endif %}

      {% if form.errors %}
      <div style="background:#fee2e2;border:1.5px solid #fca5a5;border-radius:10px;padding:.85rem 1rem;margin-bottom:1.25rem;font-size:.85rem;color:#991b1b">
        âš ï¸ Ø®Ø·Ø§:
        {% for field in form %}{% for err in field.errors %}<div>â€¢ {{ field.label }}: {{ err }}</div>{% endfor %}{% endfor %}
        {% for err in form.non_field_errors %}<div>â€¢ {{ err }}</div>{% endfor %}
      </div>
      {% endif %}

      <form method="post" enctype="multipart/form-data">
        {% csrf_token %}

        <!-- Ù†ÙˆØ¹ ØªØ±Ø§Ú©Ù†Ø´ - radio Ø¨Ø²Ø±Ú¯ -->
        <div style="margin-bottom:1.25rem">
          <label style="font-size:.85rem;font-weight:700;display:block;margin-bottom:.5rem">Ù†ÙˆØ¹ ØªØ±Ø§Ú©Ù†Ø´ <span style="color:var(--red)">*</span></label>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:.6rem">
            <label id="lbl-expense" style="display:flex;align-items:center;gap:.6rem;padding:.75rem 1rem;border:2px solid var(--red);border-radius:10px;cursor:pointer;background:#fef2f2;transition:.15s"
                   onclick="setKind('expense')">
              <input type="radio" name="transaction_type" value="expense" checked
                     style="accent-color:var(--red);width:16px;height:16px">
              <div>
                <div style="font-weight:800;font-size:.9rem;color:var(--red)">ğŸ’¸ Ù‡Ø²ÛŒÙ†Ù‡</div>
                <div style="font-size:.72rem;color:#b91c1c">Ù¾Ø±Ø¯Ø§Ø®Øª Ø§Ø² ØµÙ†Ø¯ÙˆÙ‚</div>
              </div>
            </label>
            <label id="lbl-income" style="display:flex;align-items:center;gap:.6rem;padding:.75rem 1rem;border:2px solid var(--surface-2);border-radius:10px;cursor:pointer;transition:.15s"
                   onclick="setKind('income')">
              <input type="radio" name="transaction_type" value="income"
                     style="accent-color:var(--green);width:16px;height:16px">
              <div>
                <div style="font-weight:800;font-size:.9rem;color:var(--green)">ğŸ’° Ø¯Ø±Ø¢Ù…Ø¯</div>
                <div style="font-size:.72rem;color:#047857">Ø¯Ø±ÛŒØ§ÙØª Ø¨Ù‡ ØµÙ†Ø¯ÙˆÙ‚</div>
              </div>
            </label>
          </div>
        </div>

        <!-- Ø±Ø¯ÛŒÙ Ø¹Ù†ÙˆØ§Ù† + Ø¯Ø³ØªÙ‡ -->
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-bottom:1rem">
          <div>
            <label style="font-size:.85rem;font-weight:700;display:block;margin-bottom:.3rem">Ø¹Ù†ÙˆØ§Ù† <span style="color:var(--red)">*</span></label>
            {{ form.title }}
            {% if form.title.errors %}<div style="font-size:.72rem;color:var(--red);margin-top:.2rem">{{ form.title.errors.0 }}</div>{% endif %}
          </div>
          <div>
            <label style="font-size:.85rem;font-weight:700;display:block;margin-bottom:.3rem">
              Ø¯Ø³ØªÙ‡ <span style="color:var(--red)">*</span>
              <a href="{% url 'payroll:expense-category-create' %}" style="font-size:.72rem;font-weight:600;color:var(--amber);margin-right:.5rem">+ Ø¯Ø³ØªÙ‡ Ø¬Ø¯ÛŒØ¯</a>
            </label>
            {{ form.category }}
            {% if form.category.errors %}<div style="font-size:.72rem;color:var(--red);margin-top:.2rem">{{ form.category.errors.0 }}</div>{% endif %}
          </div>
        </div>

        <!-- Ù…Ø¨Ù„Øº + ØªØ§Ø±ÛŒØ® -->
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-bottom:1rem">
          <div>
            <label style="font-size:.85rem;font-weight:700;display:block;margin-bottom:.3rem">Ù…Ø¨Ù„Øº (Ø±ÛŒØ§Ù„) <span style="color:var(--red)">*</span></label>
            {{ form.amount }}
            {% if form.amount.errors %}<div style="font-size:.72rem;color:var(--red);margin-top:.2rem">{{ form.amount.errors.0 }}</div>{% endif %}
          </div>
          <div>
            <label style="font-size:.85rem;font-weight:700;display:block;margin-bottom:.3rem">ØªØ§Ø±ÛŒØ® (Ø´Ù…Ø³ÛŒ) <span style="color:var(--red)">*</span></label>
            {{ form.date_jalali }}
            <span style="font-size:.72rem;color:var(--text-muted)">ÙØ±Ù…Øª: Û±Û´Û°Û³/Û°Û¶/Û±Ûµ</span>
            {% if form.date_jalali.errors %}<div style="font-size:.72rem;color:var(--red);margin-top:.2rem">{{ form.date_jalali.errors.0 }}</div>{% endif %}
          </div>
        </div>

        <!-- Ø´Ø±Ø­ -->
        <div style="margin-bottom:1rem">
          <label style="font-size:.85rem;font-weight:700;display:block;margin-bottom:.3rem">Ø´Ø±Ø­ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</label>
          {{ form.description }}
        </div>

        <!-- Ù¾ÛŒÙˆØ³Øª -->
        <div style="margin-bottom:1.5rem">
          <label style="font-size:.85rem;font-weight:700;display:block;margin-bottom:.3rem">Ù¾ÛŒÙˆØ³Øª (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</label>
          {{ form.attachment }}
          <span style="font-size:.72rem;color:var(--text-muted)">ØªØµÙˆÛŒØ± Ø±Ø³ÛŒØ¯ ÛŒØ§ ÙØ§Ú©ØªÙˆØ±</span>
        </div>

        <div style="display:flex;gap:.6rem;justify-content:flex-end">
          <a href="{% url 'payroll:expense-list' %}" class="btn btn-outline">Ø§Ù†ØµØ±Ø§Ù</a>
          <button type="submit" class="btn btn-amber" id="submit-btn">âœ… Ø«Ø¨Øª ØªØ±Ø§Ú©Ù†Ø´</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
function setKind(kind) {
  const lblExpense = document.getElementById('lbl-expense');
  const lblIncome  = document.getElementById('lbl-income');
  const btn        = document.getElementById('submit-btn');
  if (kind === 'expense') {
    lblExpense.style.borderColor = 'var(--red)';
    lblExpense.style.background  = '#fef2f2';
    lblIncome.style.borderColor  = 'var(--surface-2)';
    lblIncome.style.background   = '';
    btn.textContent = 'âœ… Ø«Ø¨Øª Ù‡Ø²ÛŒÙ†Ù‡';
  } else {
    lblIncome.style.borderColor  = 'var(--green)';
    lblIncome.style.background   = '#f0fdf4';
    lblExpense.style.borderColor = 'var(--surface-2)';
    lblExpense.style.background  = '';
    btn.textContent = 'âœ… Ø«Ø¨Øª Ø¯Ø±Ø¢Ù…Ø¯';
  }
}
</script>
{% endblock %}