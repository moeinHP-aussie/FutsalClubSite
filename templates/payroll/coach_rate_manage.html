{% extends "base.html" %}
{% block title %}ØªØ¹ÛŒÛŒÙ† Ù†Ø±Ø® Ù…Ø±Ø¨ÛŒØ§Ù†{% endblock %}
{% block nav_finance %}active{% endblock %}

{% block breadcrumb %}
  <span class="sep">â€º</span>
  <a href="{% url 'payroll:finance-dashboard' %}" style="text-decoration:none;color:inherit">Ù…Ø§Ù„ÛŒ</a>
  <span class="sep">â€º</span><span class="cur">Ù†Ø±Ø® Ù…Ø±Ø¨ÛŒØ§Ù†</span>
{% endblock %}

{% block content %}

<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:1.1rem;flex-wrap:wrap;gap:.75rem">
  <div>
    <h1 style="font-size:1.1rem;font-weight:900;color:var(--navy)">ğŸ’° ØªØ¹ÛŒÛŒÙ† Ù†Ø±Ø® Ø¯Ø±ÛŒØ§ÙØªÛŒ Ù…Ø±Ø¨ÛŒØ§Ù†</h1>
    <p style="font-size:.82rem;color:var(--text-muted)">Ù†Ø±Ø® Ø¯Ø±ÛŒØ§ÙØª Ù…Ø±Ø¨ÛŒ Ø¨Ù‡ Ø§Ø²Ø§ÛŒ Ù‡Ø± Ø¬Ù„Ø³Ù‡ (Ø±ÛŒØ§Ù„) â€” Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø¯Ø³ØªÙ‡ Ø¢Ù…ÙˆØ²Ø´ÛŒ</p>
  </div>
  <a href="{% url 'payroll:finance-dashboard' %}" class="btn btn-outline btn-sm">â† Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</a>
</div>

{% if messages %}{% for msg in messages %}
<div style="border-radius:8px;padding:.65rem 1rem;font-size:.85rem;margin-bottom:.45rem;
  background:{% if msg.tags == 'success' %}#dcfce7{% else %}#fee2e2{% endif %};
  color:{% if msg.tags == 'success' %}#15803d{% else %}#b91c1c{% endif %}">{{ msg }}</div>
{% endfor %}{% endif %}

<div style="background:#fffbeb;border:1px solid #fcd34d;border-radius:8px;padding:.7rem 1rem;font-size:.82rem;color:#92400e;margin-bottom:1rem">
  ğŸ’¡ <strong>Ø­Ù‚ÙˆÙ‚ Ù…Ø±Ø¨ÛŒ = ØªØ¹Ø¯Ø§Ø¯ Ø¬Ù„Ø³Ø§Øª Ø­Ø¶ÙˆØ± Ã— Ù†Ø±Ø® Ù‡Ø± Ø¬Ù„Ø³Ù‡</strong> + ØªØ¹Ø¯ÛŒÙ„ Ø¯Ø³ØªÛŒ Ù…Ø¯ÛŒØ± Ù…Ø§Ù„ÛŒ<br>
  Ø®Ø§Ù„ÛŒ Ú¯Ø°Ø§Ø´ØªÙ† ÛŒØ§ ØµÙØ± â†’ Ù†Ø±Ø® Ø­Ø°Ù Ù…ÛŒâ€ŒØ´ÙˆØ¯.
</div>

<div class="card">
  <form method="post" style="padding:0">
    {% csrf_token %}
    <div style="overflow-x:auto">
      <table class="table" style="border-collapse:collapse">
        <thead>
          <tr style="background:var(--surface-1)">
            <th style="position:sticky;right:0;background:var(--surface-1);min-width:155px;z-index:2;border-left:2px solid var(--surface-2)">Ù…Ø±Ø¨ÛŒ</th>
            {% for cat in categories %}
            <th style="text-align:center;min-width:148px;padding:.6rem .5rem">
              <div style="font-size:.82rem;font-weight:700;color:var(--navy)">{{ cat.name }}</div>
              <div style="font-size:.7rem;color:var(--text-muted);margin-top:.1rem">{{ cat.monthly_fee|floatformat:0 }} Ø±/Ù…Ø§Ù‡</div>
            </th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for row in coaches_with_rates %}
          <tr>
            <td style="position:sticky;right:0;background:#fff;z-index:1;border-left:2px solid var(--surface-2)">
              <div style="font-size:.88rem;font-weight:700">{{ row.coach.first_name }} {{ row.coach.last_name }}</div>
              {% if row.coach.degree %}<div style="font-size:.7rem;color:var(--text-muted)">{{ row.coach.get_degree_display }}</div>{% endif %}
            </td>
            {% for cr in row.cat_rates %}
            <td style="text-align:center;padding:.45rem .5rem">
              <input type="number"
                     name="{{ cr.field_name }}"
                     value="{{ cr.value }}"
                     class="rate-input {% if cr.value %}has-rate{% endif %}"
                     placeholder="â€”"
                     min="0" step="1000">
            </td>
            {% endfor %}
          </tr>
          {% empty %}
          <tr>
            <td colspan="{{ categories|length|add:1 }}" style="text-align:center;padding:2.5rem;color:var(--text-muted)">
              Ù…Ø±Ø¨ÛŒ ÙØ¹Ø§Ù„ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <div style="padding:.85rem 1rem;border-top:1px solid var(--surface-2);display:flex;justify-content:flex-end;gap:.5rem">
      <a href="{% url 'payroll:finance-dashboard' %}" class="btn btn-outline">Ø§Ù†ØµØ±Ø§Ù</a>
      <button type="submit" class="btn btn-navy">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ Ù‡Ù…Ù‡ Ù†Ø±Ø®â€ŒÙ‡Ø§</button>
    </div>
  </form>
</div>

<style>
.rate-input {
  width: 115px; padding: .38rem .5rem;
  border: 1.5px solid var(--surface-2); border-radius: 7px;
  font-family: monospace; font-size: .85rem; text-align: center;
  transition: border-color .15s, background .15s; background: #fafafa;
}
.rate-input:focus       { outline: none; border-color: var(--navy); background: #f0f9ff; }
.rate-input.has-rate    { border-color: #86efac; background: #f0fdf4; font-weight:700; }
.rate-input::placeholder{ color: #d1d5db; font-size: .75rem; }
</style>

<script>
document.querySelectorAll('.rate-input').forEach(function(inp){
  inp.addEventListener('input', function(){
    this.classList.toggle('has-rate', this.value && this.value !== '0');
  });
});
</script>

{% endblock %}