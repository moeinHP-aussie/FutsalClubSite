{% extends "base.html" %}
{% block title %}ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù…Ø§Ù„ÛŒ Ú©Ø§Ù…Ù„{% endblock %}
{% block nav_finance %}active{% endblock %}

{% block breadcrumb %}
  <span class="sep">â€º</span>
  <a href="{% url 'payroll:finance-dashboard' %}" style="text-decoration:none;color:inherit">Ù…Ø§Ù„ÛŒ</a>
  <span class="sep">â€º</span><span class="cur">ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ú©Ø§Ù…Ù„</span>
{% endblock %}

{% block content %}
<div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:.75rem;margin-bottom:1.25rem">
  <div>
    <h1 style="font-size:1.1rem;font-weight:900;color:var(--navy)">ğŸ“Š ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù…Ø§Ù„ÛŒ Ú©Ø§Ù…Ù„</h1>
    <p style="font-size:.82rem;color:var(--text-muted)">ØªÙ…Ø§Ù… ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ÛŒ Ù…Ø§Ù„ÛŒ Ø³ÛŒØ³ØªÙ…</p>
  </div>
  <a href="{% url 'payroll:finance-dashboard' %}" class="btn btn-outline btn-sm">â† Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</a>
</div>

<!-- ÙÛŒÙ„ØªØ± -->
<div class="card" style="margin-bottom:1rem">
  <form method="get" style="padding:.85rem 1.1rem;display:flex;flex-wrap:wrap;gap:.65rem;align-items:flex-end">
    <div>
      <label style="font-size:.75rem;font-weight:700;display:block;margin-bottom:.25rem">Ù†ÙˆØ¹ ØªØ±Ø§Ú©Ù†Ø´</label>
      <select name="tx_type" style="padding:.4rem .65rem;border:1.5px solid var(--surface-2);border-radius:8px;font-family:inherit;font-size:.82rem;background:#fff">
        <option value="">Ù‡Ù…Ù‡</option>
        {% for val, lbl in tx_type_choices %}
        <option value="{{ val }}" {% if tx_type_filter == val %}selected{% endif %}>{{ lbl }}</option>
        {% endfor %}
      </select>
    </div>
    <div>
      <label style="font-size:.75rem;font-weight:700;display:block;margin-bottom:.25rem">Ú©Ø§Ø±Ø¨Ø±</label>
      <select name="user_id" style="padding:.4rem .65rem;border:1.5px solid var(--surface-2);border-radius:8px;font-family:inherit;font-size:.82rem;background:#fff">
        <option value="">Ù‡Ù…Ù‡ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</option>
        {% for u in users %}
        <option value="{{ u.pk }}" {% if user_filter == u.pk|stringformat:"s" %}selected{% endif %}>
          {{ u.get_full_name }}
        </option>
        {% endfor %}
      </select>
    </div>
    <button type="submit" class="btn btn-navy btn-sm">ğŸ” ÙÛŒÙ„ØªØ±</button>
    <a href="{% url 'payroll:all-financial-history' %}" class="btn btn-outline btn-sm">Ã— Ù¾Ø§Ú©â€ŒÚ©Ø±Ø¯Ù†</a>
  </form>
</div>

{% if transactions %}
<div class="card">
  <div style="overflow-x:auto">
    <table class="table">
      <thead>
        <tr>
          <th>ØªØ§Ø±ÛŒØ®</th>
          <th>Ú©Ø§Ø±Ø¨Ø±</th>
          <th>Ù†ÙˆØ¹</th>
          <th>Ø¬Ù‡Øª</th>
          <th>Ù…Ø¨Ù„Øº (Ø±ÛŒØ§Ù„)</th>
          <th>ØªÙˆØ¶ÛŒØ­</th>
          <th>Ø«Ø¨Øªâ€ŒØ´Ø¯Ù‡ ØªÙˆØ³Ø·</th>
        </tr>
      </thead>
      <tbody>
        {% for tx in transactions %}
        <tr>
          <td style="font-size:.78rem;color:var(--text-muted)">{{ tx.created_at|date:"Y/m/d" }}</td>
          <td>
            <strong style="font-size:.85rem">{{ tx.user.get_full_name }}</strong>
            <div style="font-size:.7rem;color:var(--text-muted)">@{{ tx.user.username }}</div>
          </td>
          <td><span style="font-size:.78rem">{{ tx.get_tx_type_display }}</span></td>
          <td>
            {% if tx.direction == 'credit' %}
            <span class="badge badge-green" style="font-size:.65rem">â†“ Ø¯Ø±ÛŒØ§ÙØª</span>
            {% else %}
            <span class="badge badge-red" style="font-size:.65rem">â†‘ Ù¾Ø±Ø¯Ø§Ø®Øª</span>
            {% endif %}
          </td>
          <td style="font-family:monospace;font-size:.88rem;font-weight:700;
                     color:{% if tx.direction == 'credit' %}var(--green){% else %}var(--red){% endif %}">
            {{ tx.amount|floatformat:0 }}
          </td>
          <td style="font-size:.8rem;max-width:200px">{{ tx.description|truncatechars:60 }}</td>
          <td style="font-size:.75rem;color:var(--text-muted)">
            {% if tx.performed_by %}{{ tx.performed_by.get_full_name }}{% else %}Ø³ÛŒØ³ØªÙ…{% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% if is_paginated %}
  <div style="padding:.75rem 1rem;border-top:1px solid var(--surface-2);display:flex;gap:.4rem;justify-content:center">
    {% if page_obj.has_previous %}
    <a href="?page={{ page_obj.previous_page_number }}&tx_type={{ tx_type_filter }}&user_id={{ user_filter }}" class="btn btn-outline btn-sm">â†</a>
    {% endif %}
    <span style="padding:.35rem .75rem;font-size:.82rem">{{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span>
    {% if page_obj.has_next %}
    <a href="?page={{ page_obj.next_page_number }}&tx_type={{ tx_type_filter }}&user_id={{ user_filter }}" class="btn btn-outline btn-sm">â†’</a>
    {% endif %}
  </div>
  {% endif %}
</div>
{% else %}
<div style="text-align:center;padding:3rem;color:var(--text-muted)">
  <div style="font-size:2.5rem;margin-bottom:.5rem">ğŸ“­</div>
  <p style="font-weight:700">ØªØ±Ø§Ú©Ù†Ø´ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</p>
</div>
{% endif %}
{% endblock %}