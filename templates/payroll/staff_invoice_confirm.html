{% extends "base.html" %}
{% block title %}ØªØ£ÛŒÛŒØ¯ Ø¯Ø±ÛŒØ§ÙØª ÙØ§Ú©ØªÙˆØ±{% endblock %}

{% block breadcrumb %}
  <span class="sep">â€º</span>
  <a href="{% url 'payroll:my-financial-history' %}" style="text-decoration:none;color:inherit">Ø³ÙˆØ§Ø¨Ù‚ Ù…Ø§Ù„ÛŒ</a>
  <span class="sep">â€º</span><span class="cur">ØªØ£ÛŒÛŒØ¯ ÙØ§Ú©ØªÙˆØ±</span>
{% endblock %}

{% block extra_head %}
<style>
.confirm-card { max-width:520px; margin:0 auto; }
.receipt-view { background:#f8fafc; border-radius:12px; border:1.5px solid var(--surface-2); overflow:hidden; min-height:280px; display:flex; align-items:center; justify-content:center; cursor:zoom-in; }
.receipt-view img { max-width:100%; max-height:400px; object-fit:contain; }
#lb{display:none;position:fixed;inset:0;background:rgba(0,0,0,.9);z-index:9999;place-items:center;cursor:zoom-out}
#lb.on{display:grid}
</style>
{% endblock %}

{% block content %}
<div class="confirm-card">
  <div style="text-align:center;margin-bottom:1.5rem">
    <div style="font-size:2.5rem;margin-bottom:.5rem">ğŸ“„</div>
    <h1 style="font-size:1.1rem;font-weight:900;color:var(--navy)">ØªØ£ÛŒÛŒØ¯ Ø¯Ø±ÛŒØ§ÙØª ÙØ§Ú©ØªÙˆØ±</h1>
    <p style="font-size:.82rem;color:var(--text-muted)">Ù„Ø·ÙØ§Ù‹ ÙÛŒØ´ Ø¨Ø§Ù†Ú©ÛŒ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ùˆ Ø¯Ø±ÛŒØ§ÙØª Ø±Ø§ ØªØ£ÛŒÛŒØ¯ Ú©Ù†ÛŒØ¯</p>
  </div>

  {% if messages %}{% for msg in messages %}
  <div style="border-radius:8px;padding:.6rem 1rem;font-size:.83rem;margin-bottom:.75rem;
    background:{% if msg.tags == 'success' %}#dcfce7{% elif msg.tags == 'error' %}#fee2e2{% else %}#fef9c3{% endif %};
    color:{% if msg.tags == 'success' %}#15803d{% elif msg.tags == 'error' %}#b91c1c{% else %}#854d0e{% endif %}">{{ msg }}</div>
  {% endfor %}{% endif %}

  <!-- Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙØ§Ú©ØªÙˆØ± -->
  <div style="background:var(--surface-1);border-radius:10px;padding:1rem;margin-bottom:1.25rem;border:1px solid var(--surface-2)">
    <table style="width:100%;font-size:.85rem">
      <tr>
        <td style="color:var(--text-muted);padding:.3rem 0;width:40%">Ø¹Ù†ÙˆØ§Ù†</td>
        <td style="font-weight:700">{{ invoice.title }}</td>
      </tr>
      {% if invoice.description %}
      <tr>
        <td style="color:var(--text-muted);padding:.3rem 0">Ø´Ø±Ø­</td>
        <td style="font-size:.82rem">{{ invoice.description }}</td>
      </tr>
      {% endif %}
      <tr>
        <td style="color:var(--text-muted);padding:.3rem 0">Ù…Ø¨Ù„Øº</td>
        <td style="font-size:1.05rem;font-weight:900;color:var(--navy);font-family:monospace">
          {{ invoice.amount|floatformat:0 }} Ø±ÛŒØ§Ù„
        </td>
      </tr>
      <tr>
        <td style="color:var(--text-muted);padding:.3rem 0">ØµØ§Ø¯Ø±Ú©Ù†Ù†Ø¯Ù‡</td>
        <td>{{ invoice.created_by.get_full_name }}</td>
      </tr>
      <tr>
        <td style="color:var(--text-muted);padding:.3rem 0">ÙˆØ¶Ø¹ÛŒØª</td>
        <td>
          {% if invoice.status == 'confirmed' %}
          <span style="background:#d1fae5;color:#065f46;border-radius:6px;padding:.2rem .55rem;font-size:.78rem;font-weight:700">âœ… ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡</span>
          {% elif invoice.status == 'paid' %}
          <span style="background:#fef3c7;color:#92400e;border-radius:6px;padding:.2rem .55rem;font-size:.78rem;font-weight:700">â³ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ£ÛŒÛŒØ¯ Ø´Ù…Ø§</span>
          {% endif %}
        </td>
      </tr>
    </table>
  </div>

  <!-- ØªØµÙˆÛŒØ± ÙÛŒØ´ Ø¨Ø§Ù†Ú©ÛŒ -->
  {% if invoice.bank_receipt %}
  <div style="margin-bottom:1.25rem">
    <div style="font-size:.82rem;font-weight:700;color:var(--navy);margin-bottom:.5rem">ğŸ“ ÙÛŒØ´ Ø¨Ø§Ù†Ú©ÛŒ Ø§Ø±Ø³Ø§Ù„â€ŒØ´Ø¯Ù‡</div>
    <div class="receipt-view" onclick="openLB('{{ invoice.bank_receipt.url }}')">
      <img src="{{ invoice.bank_receipt.url }}" alt="ÙÛŒØ´ Ù¾Ø±Ø¯Ø§Ø®Øª">
    </div>
    <a href="{{ invoice.bank_receipt.url }}" target="_blank" download
       style="display:block;text-align:center;margin-top:.5rem;font-size:.78rem;color:var(--navy)">
      â¬‡ï¸ Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙÛŒØ´ Ø¨Ø§Ù†Ú©ÛŒ
    </a>
  </div>
  {% else %}
  <div style="background:#fef3c7;border-radius:10px;padding:1rem;text-align:center;margin-bottom:1.25rem;font-size:.85rem;color:#92400e">
    âš ï¸ ÙÛŒØ´ Ø¨Ø§Ù†Ú©ÛŒ Ù‡Ù†ÙˆØ² Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù†Ø´Ø¯Ù‡. Ù„Ø·ÙØ§Ù‹ Ø¨Ø§ Ù…Ø¯ÛŒØ± Ù…Ø§Ù„ÛŒ ØªÙ…Ø§Ø³ Ø¨Ú¯ÛŒØ±ÛŒØ¯.
  </div>
  {% endif %}

  {% if invoice.status == 'paid' %}
  <form method="post" onsubmit="return confirm('Ø¯Ø±ÛŒØ§ÙØª Ù…Ø¨Ù„Øº {{ invoice.amount|floatformat:0 }} Ø±ÛŒØ§Ù„ ØªØ£ÛŒÛŒØ¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŸ')">
    {% csrf_token %}
    <input type="hidden" name="action" value="confirm">
    <button type="submit" class="btn btn-green"
            style="width:100%;padding:.7rem;font-size:.92rem;font-weight:800;margin-bottom:.65rem">
      âœ… ØªØ£ÛŒÛŒØ¯ Ø¯Ø±ÛŒØ§ÙØª ÙˆØ¬Ù‡
    </button>
  </form>
  <div style="border-top:1px solid var(--surface-2);padding-top:.75rem">
    <div style="font-size:.8rem;font-weight:700;color:var(--text-muted);margin-bottom:.4rem">âš ï¸ Ø§Ø¹ØªØ±Ø§Ø¶</div>
    <form method="post" onsubmit="return confirm('Ø§Ø¹ØªØ±Ø§Ø¶ Ø«Ø¨Øª Ùˆ Ø¨Ù‡ Ù…Ø¯ÛŒØ± Ù…Ø§Ù„ÛŒ Ø§Ø±Ø³Ø§Ù„ Ø´ÙˆØ¯ØŸ')">
      {% csrf_token %}
      <input type="hidden" name="action" value="dispute">
      <textarea name="note" rows="2" placeholder="Ø¯Ù„ÛŒÙ„ Ø§Ø¹ØªØ±Ø§Ø¶..."
                style="width:100%;padding:.5rem .7rem;border:1.5px solid var(--surface-2);border-radius:7px;font-size:.82rem;margin-bottom:.4rem;box-sizing:border-box;resize:none"></textarea>
      <button type="submit" class="btn btn-outline"
              style="width:100%;font-size:.82rem;color:var(--red);border-color:var(--red)">
        âš ï¸ Ø«Ø¨Øª Ø§Ø¹ØªØ±Ø§Ø¶
      </button>
    </form>
  </div>
  {% elif invoice.status == 'confirmed' %}
  <div style="background:#d1fae5;border-radius:10px;padding:1.1rem;text-align:center;font-weight:700;color:#065f46">
    âœ… Ø´Ù…Ø§ Ø§ÛŒÙ† ÙØ§Ú©ØªÙˆØ± Ø±Ø§ ØªØ£ÛŒÛŒØ¯ Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯
  </div>
  {% endif %}
</div>

<div id="lb" onclick="this.classList.remove('on')">
  <img id="lb-img" style="max-width:94vw;max-height:94vh;object-fit:contain;border-radius:8px">
</div>
<script>function openLB(u){document.getElementById('lb-img').src=u;document.getElementById('lb').classList.add('on');}</script>
{% endblock %}
