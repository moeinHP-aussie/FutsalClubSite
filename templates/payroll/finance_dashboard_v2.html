{% extends "base.html" %}
{% block title %}Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù…Ø§Ù„ÛŒ{% endblock %}
{% block nav_finance %}active{% endblock %}

{% block breadcrumb %}
  <span class="sep">â€º</span><span class="cur">Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù…Ø§Ù„ÛŒ</span>
{% endblock %}

{% block extra_head %}
<style>
.hub-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:1rem; margin-bottom:1.5rem; }
.hub-card { background:#fff; border-radius:14px; border:1.5px solid var(--surface-2); padding:1.25rem 1.4rem; text-decoration:none; color:inherit; transition:.15s; position:relative; overflow:hidden; }
.hub-card:hover { border-color:var(--navy); box-shadow:0 4px 16px rgba(0,0,50,.09); transform:translateY(-2px); }
.hub-card-icon { font-size:2rem; margin-bottom:.6rem; }
.hub-card-title { font-size:.92rem; font-weight:900; color:var(--navy); margin-bottom:.3rem; }
.hub-card-sub { font-size:.78rem; color:var(--text-muted); }
.hub-badge { position:absolute; top:.65rem; left:.65rem; background:#ef4444; color:#fff; border-radius:99px; font-size:.65rem; padding:.15rem .5rem; font-weight:800; }
.hub-stat { display:flex; justify-content:space-between; margin-top:.75rem; padding-top:.65rem; border-top:1px solid var(--surface-2); }
.hub-stat-item { text-align:center; }
.hub-stat-num { font-size:1rem; font-weight:900; }
.hub-stat-lbl { font-size:.65rem; color:var(--text-muted); }
</style>
{% endblock %}

{% block content %}
<div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:.75rem;margin-bottom:1.5rem">
  <div>
    <h1 style="font-size:1.2rem;font-weight:900;color:var(--navy)">ğŸ¦ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù…Ø§Ù„ÛŒ</h1>
    <p style="font-size:.82rem;color:var(--text-muted)">Ù…Ø±Ú©Ø² Ù…Ø¯ÛŒØ±ÛŒØª ØªÙ…Ø§Ù… Ø¬Ø±ÛŒØ§Ù†â€ŒÙ‡Ø§ÛŒ Ù…Ø§Ù„ÛŒ Ø¨Ø§Ø´Ú¯Ø§Ù‡</p>
  </div>
  <!-- Ù†Ø§ÙˆØ¨Ø±ÛŒ Ù…Ø§Ù‡ -->
  <div style="display:flex;gap:.45rem;align-items:center">
    <a href="?year={{ prev_month.year }}&month={{ prev_month.month }}" class="btn btn-outline btn-sm">â† Ù…Ø§Ù‡ Ù‚Ø¨Ù„</a>
    <span style="font-weight:800;font-size:.95rem;background:var(--surface-1);padding:.35rem .85rem;border-radius:8px">
      {{ month.year }}/{% if month.month < 10 %}0{% endif %}{{ month.month }}
    </span>
    <a href="?year={{ next_month.year }}&month={{ next_month.month }}" class="btn btn-outline btn-sm">Ù…Ø§Ù‡ Ø¨Ø¹Ø¯ â†’</a>
  </div>
</div>

<!-- Û¶ Ú©Ø§Ø±Øª Ø§ØµÙ„ÛŒ -->
<div class="hub-grid">

  <!-- Û±. Ù…Ø¯ÛŒØ±ÛŒØª Ø´Ù‡Ø±ÛŒÙ‡ -->
  <a href="{% url 'payroll:tuition-categories' %}?year={{ month.year }}&month={{ month.month }}"
     class="hub-card" style="border-top:4px solid var(--navy)">
    <div class="hub-card-icon">ğŸ§¾</div>
    <div class="hub-card-title">Ù…Ø¯ÛŒØ±ÛŒØª Ø´Ù‡Ø±ÛŒÙ‡</div>
    <div class="hub-card-sub">ÙØ§Ú©ØªÙˆØ±ØŒ Ø±Ø³ÛŒØ¯ØŒ ØªØ£ÛŒÛŒØ¯ Ù¾Ø±Ø¯Ø§Ø®Øª</div>
    <div class="hub-stat">
      <div class="hub-stat-item">
        <div class="hub-stat-num" style="color:var(--green)">{{ invoice_stats.paid }}</div>
        <div class="hub-stat-lbl">Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒØ´Ø¯Ù‡</div>
      </div>
      <div class="hub-stat-item">
        <div class="hub-stat-num" style="color:var(--amber)">{{ invoice_stats.pending }}</div>
        <div class="hub-stat-lbl">Ù…Ø¹ÙˆÙ‚</div>
      </div>
      <div class="hub-stat-item">
        <div class="hub-stat-num" style="color:#ef4444">{{ invoice_stats.debtor }}</div>
        <div class="hub-stat-lbl">Ø¨Ø¯Ù‡Ú©Ø§Ø±</div>
      </div>
    </div>
    {% if invoice_stats.pending_confirm > 0 %}
    <div class="hub-badge">{{ invoice_stats.pending_confirm }} Ø±Ø³ÛŒØ¯</div>
    {% endif %}
  </a>

  <!-- Û². Ø­Ù‚ÙˆÙ‚ Ù…Ø±Ø¨ÛŒØ§Ù† -->
  <a href="{% url 'payroll:tuition-categories' %}?section=salary&year={{ month.year }}&month={{ month.month }}"
     class="hub-card" style="border-top:4px solid var(--teal)">
    <div class="hub-card-icon">ğŸ‘¨â€ğŸ«</div>
    <div class="hub-card-title">Ø­Ù‚ÙˆÙ‚ Ù…Ø±Ø¨ÛŒØ§Ù†</div>
    <div class="hub-card-sub">Ù…Ø­Ø§Ø³Ø¨Ù‡ØŒ Ø¢Ù¾Ù„ÙˆØ¯ ÙÛŒØ´ØŒ ØªØ£ÛŒÛŒØ¯ Ù…Ø±Ø¨ÛŒ</div>
    {% if pending_receipt_count > 0 %}
    <div class="hub-badge">{{ pending_receipt_count }} Ø±Ø³ÛŒØ¯</div>
    {% endif %}
  </a>

  <!-- Û³. Ø±Ø³ÛŒØ¯Ù‡Ø§ÛŒ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± -->
  <a href="{% url 'payroll:pending-receipts' %}" class="hub-card" style="border-top:4px solid #f59e0b">
    <div class="hub-card-icon">ğŸ“</div>
    <div class="hub-card-title">Ø±Ø³ÛŒØ¯Ù‡Ø§ÛŒ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</div>
    <div class="hub-card-sub">Ø¨Ø±Ø±Ø³ÛŒ Ùˆ ØªØ£ÛŒÛŒØ¯ Ø±Ø³ÛŒØ¯Ù‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù†</div>
    {% if invoice_stats.pending_confirm > 0 %}
    <div class="hub-stat">
      <div class="hub-stat-item">
        <div class="hub-stat-num" style="color:#f59e0b">{{ invoice_stats.pending_confirm }}</div>
        <div class="hub-stat-lbl">Ù…Ù†ØªØ¸Ø± Ø¨Ø±Ø±Ø³ÛŒ</div>
      </div>
    </div>
    <div class="hub-badge">Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø§Ù‚Ø¯Ø§Ù…</div>
    {% else %}
    <div style="margin-top:.75rem;font-size:.78rem;color:var(--green);font-weight:700">âœ… Ù‡Ù…Ù‡ Ø¨Ø±Ø±Ø³ÛŒ Ø´Ø¯Ù‡</div>
    {% endif %}
  </a>

  <!-- Û´. ÙØ§Ú©ØªÙˆØ± Ø¯Ø³ØªÛŒ -->
  <a href="{% url 'payroll:staff-invoice-list' %}" class="hub-card" style="border-top:4px solid #8b5cf6">
    <div class="hub-card-icon">ğŸ“„</div>
    <div class="hub-card-title">ÙØ§Ú©ØªÙˆØ± Ø¯Ø³ØªÛŒ</div>
    <div class="hub-card-sub">ØµØ¯ÙˆØ±ØŒ Ù¾Ø±Ø¯Ø§Ø®ØªØŒ ØªØ£ÛŒÛŒØ¯ Ú¯ÛŒØ±Ù†Ø¯Ù‡</div>
    {% if staff_pending_count > 0 %}
    <div class="hub-badge">{{ staff_pending_count }} Ù…Ù†ØªØ¸Ø±</div>
    {% endif %}
  </a>

  <!-- Ûµ. ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù…Ø§Ù„ÛŒ -->
  <a href="{% url 'payroll:all-financial-history' %}" class="hub-card" style="border-top:4px solid var(--green)">
    <div class="hub-card-icon">ğŸ“Š</div>
    <div class="hub-card-title">ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù…Ø§Ù„ÛŒ Ú©Ù„</div>
    <div class="hub-card-sub">Ú¯Ø²Ø§Ø±Ø´ ØªÙ…Ø§Ù… ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§</div>
  </a>

  <!-- Û¶. Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ -->
  <a href="{% url 'payroll:expense-list' %}" class="hub-card" style="border-top:4px solid var(--red)">
    <div class="hub-card-icon">ğŸ’¸</div>
    <div class="hub-card-title">Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ Ùˆ Ø¯Ø±Ø¢Ù…Ø¯Ù‡Ø§</div>
    <div class="hub-card-sub">Ø«Ø¨Øª Ùˆ Ù¾Ø§ÛŒØ´ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ÛŒ ØµÙ†Ø¯ÙˆÙ‚</div>
  </a>

</div>

<!-- Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ -->
<div style="display:flex;gap:.65rem;flex-wrap:wrap;padding:.85rem 1rem;background:var(--surface-1);border-radius:10px;border:1px solid var(--surface-2)">
  <span style="font-size:.8rem;color:var(--text-muted);margin-left:.5rem;line-height:2">Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§:</span>
  <a href="{% url 'payroll:coach-rate-manage' %}" class="btn btn-outline btn-sm">âš™ï¸ Ù†Ø±Ø® Ù…Ø±Ø¨ÛŒØ§Ù†</a>
  <a href="{% url 'payroll:player-payment-status' %}" class="btn btn-outline btn-sm">ğŸ“‹ ÙˆØ¶Ø¹ÛŒØª Ø´Ù‡Ø±ÛŒÙ‡</a>
  <a href="{% url 'payroll:expense-category-list' %}" class="btn btn-outline btn-sm">ğŸ—‚ï¸ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù‡Ø²ÛŒÙ†Ù‡</a>
  <a href="{% url 'payroll:my-financial-history' %}" class="btn btn-outline btn-sm">ğŸ‘¤ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù…Ù†</a>
  {% if request.user.is_finance_manager %}
  <form method="post" action="{% url 'payroll:invoice-generate-all' %}" style="margin:0"
        onsubmit="return confirm('ÙØ§Ú©ØªÙˆØ± Ø´Ù‡Ø±ÛŒÙ‡ {{ month.year }}/{{ month.month }} Ø¨Ø±Ø§ÛŒ Ù‡Ù…Ù‡ Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§ ØµØ§Ø¯Ø± Ø´ÙˆØ¯ØŸ')">
    {% csrf_token %}
    <input type="hidden" name="year"  value="{{ month.year }}">
    <input type="hidden" name="month" value="{{ month.month }}">
    <button class="btn btn-navy btn-sm">ğŸ“¤ ØµØ¯ÙˆØ± ÙØ§Ú©ØªÙˆØ± Ù‡Ù…Ù‡ Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§</button>
  </form>
  {% endif %}
</div>
{% endblock %}