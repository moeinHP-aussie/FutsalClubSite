{% extends "base.html" %}
{% block title %}Ø¨Ø±Ø±Ø³ÛŒ Ù…ØªÙ‚Ø§Ø¶ÛŒ â€” {{ player.first_name }} {{ player.last_name }}{% endblock %}
{% block nav_applicants %}active{% endblock %}

{% block breadcrumb %}
  <span class="sep">â€º</span>
  <a href="{% url 'registration:applicant-list' %}" style="text-decoration:none;color:inherit">Ù…ØªÙ‚Ø§Ø¶ÛŒØ§Ù†</a>
  <span class="sep">â€º</span>
  <span class="cur">{{ player.first_name }} {{ player.last_name }}</span>
{% endblock %}

{% block extra_head %}
<style>
.info-row {
  display: flex; justify-content: space-between; align-items: flex-start;
  padding: .55rem 0; border-bottom: 1px solid var(--surface-2);
  gap: .5rem;
}
.info-row:last-child { border-bottom: none; }
.info-label { font-size: .8rem; color: var(--text-muted); flex-shrink: 0; }
.info-val   { font-size: .875rem; font-weight: 600; text-align: left; }

/* Approve panel */
.approve-panel {
  border: 2px solid var(--green);
  border-radius: var(--radius);
  padding: 1.25rem 1.5rem;
  background: #f0fdf4;
  margin-bottom: 1rem;
}
.reject-panel {
  border: 2px solid var(--red);
  border-radius: var(--radius);
  padding: 1.25rem 1.5rem;
  background: #fef2f2;
}
.section-divider {
  font-size: .72rem; font-weight: 700;
  text-transform: uppercase; letter-spacing: .06em;
  color: var(--text-muted);
  padding: .5rem 0 .25rem;
  border-bottom: 1px solid var(--surface-2);
  margin-bottom: .75rem;
}
</style>
{% endblock %}

{% block content %}

<!-- â”€â”€ Status Banner â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
{% if player.status == 'pending' %}
<div style="background:linear-gradient(90deg,#fffbeb,#fef9c3);border:1.5px solid #fde68a;border-radius:var(--radius);padding:.85rem 1.25rem;display:flex;align-items:center;gap:.75rem;margin-bottom:1.25rem">
  <span style="font-size:1.4rem">â³</span>
  <div>
    <strong style="color:#92400e">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø±Ø±Ø³ÛŒ</strong>
    <div style="font-size:.8rem;color:#a16207;margin-top:.1rem">Ø§ÛŒÙ† Ù…ØªÙ‚Ø§Ø¶ÛŒ Ù‡Ù†ÙˆØ² ØªØ£ÛŒÛŒØ¯ ÛŒØ§ Ø±Ø¯ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</div>
  </div>
</div>
{% elif player.status == 'approved' %}
<div style="background:#d1fae5;border:1.5px solid #a7f3d0;border-radius:var(--radius);padding:.85rem 1.25rem;display:flex;align-items:center;gap:.75rem;margin-bottom:1.25rem">
  <span style="font-size:1.4rem">âœ…</span>
  <div>
    <strong style="color:#065f46">ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡</strong>
    {% if player.approved_by %}
    <div style="font-size:.8rem;color:#047857;margin-top:.1rem">ØªÙˆØ³Ø· {{ player.approved_by.get_full_name }} | {{ player.approval_date|date:"Y/m/d" }}</div>
    {% endif %}
  </div>
</div>
{% elif player.status == 'rejected' %}
<div style="background:#fee2e2;border:1.5px solid #fca5a5;border-radius:var(--radius);padding:.85rem 1.25rem;display:flex;align-items:center;gap:.75rem;margin-bottom:1.25rem">
  <span style="font-size:1.4rem">âŒ</span>
  <div>
    <strong style="color:#991b1b">Ø±Ø¯ Ø´Ø¯Ù‡</strong>
    {% if player.rejection_reason %}<div style="font-size:.8rem;color:#b91c1c;margin-top:.1rem">{{ player.rejection_reason }}</div>{% endif %}
  </div>
</div>
{% endif %}

<div style="display:grid;grid-template-columns:1fr 340px;gap:1.25rem;align-items:start">

<!-- â”€â”€ Left: Player Info â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div>

  <!-- Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒ -->
  <div class="card" style="margin-bottom:1rem">
    <div class="card-header">
      <span class="card-title">ğŸ‘¤ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒ</span>
      <span style="font-size:.78rem;color:var(--text-muted);font-family:monospace">{{ player.player_id }}</span>
    </div>
    <div style="padding:.75rem 1.25rem">
      <div class="info-row"><span class="info-label">Ù†Ø§Ù… Ú©Ø§Ù…Ù„</span><span class="info-val">{{ player.first_name }} {{ player.last_name }}</span></div>
      <div class="info-row"><span class="info-label">Ù†Ø§Ù… Ù¾Ø¯Ø±</span><span class="info-val">{{ player.father_name }}</span></div>
      <div class="info-row"><span class="info-label">Ú©Ø¯ Ù…Ù„ÛŒ</span><span class="info-val" style="font-family:monospace">{{ player.national_id }}</span></div>
      <div class="info-row"><span class="info-label">ØªØ§Ø±ÛŒØ® ØªÙˆÙ„Ø¯</span><span class="info-val">{{ player.dob }}</span></div>
      {% if age_category %}<div class="info-row"><span class="info-label">Ø±Ø¯Ù‡ Ø³Ù†ÛŒ</span><span class="info-val"><span class="badge badge-teal">{{ age_category }}</span></span></div>{% endif %}
      <div class="info-row"><span class="info-label">Ù…ÙˆØ¨Ø§ÛŒÙ„</span><span class="info-val">{{ player.phone }}</span></div>
      <div class="info-row"><span class="info-label">Ù…ÙˆØ¨Ø§ÛŒÙ„ Ù¾Ø¯Ø±</span><span class="info-val">{{ player.father_phone }}</span></div>
      {% if player.mother_phone %}<div class="info-row"><span class="info-label">Ù…ÙˆØ¨Ø§ÛŒÙ„ Ù…Ø§Ø¯Ø±</span><span class="info-val">{{ player.mother_phone }}</span></div>{% endif %}
      {% if player.address %}<div class="info-row"><span class="info-label">Ø¢Ø¯Ø±Ø³</span><span class="info-val" style="max-width:60%">{{ player.address }}</span></div>{% endif %}
    </div>
  </div>

  <!-- Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ -->
  <div class="card" style="margin-bottom:1rem">
    <div class="card-header"><span class="card-title">ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</span></div>
    <div style="padding:.75rem 1.25rem">
      <div class="info-row"><span class="info-label">ØªØ­ØµÛŒÙ„Ø§Øª Ù¾Ø¯Ø±</span><span class="info-val">{{ player.get_father_education_display|default:"â€”" }}</span></div>
      <div class="info-row"><span class="info-label">Ø´ØºÙ„ Ù¾Ø¯Ø±</span><span class="info-val">{{ player.father_job|default:"â€”" }}</span></div>
      <div class="info-row"><span class="info-label">ØªØ­ØµÛŒÙ„Ø§Øª Ù…Ø§Ø¯Ø±</span><span class="info-val">{{ player.get_mother_education_display|default:"â€”" }}</span></div>
      <div class="info-row"><span class="info-label">Ø´ØºÙ„ Ù…Ø§Ø¯Ø±</span><span class="info-val">{{ player.mother_job|default:"â€”" }}</span></div>
    </div>
  </div>

  <!-- Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¬Ø³Ù…Ø§Ù†ÛŒ -->
  <div class="card" style="margin-bottom:1rem">
    <div class="card-header"><span class="card-title">ğŸ“ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¬Ø³Ù…Ø§Ù†ÛŒ</span></div>
    <div style="padding:.75rem 1.25rem">
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:0">
        <div class="info-row"><span class="info-label">Ù‚Ø¯</span><span class="info-val">{% if player.height %}{{ player.height }} cm{% else %}â€”{% endif %}</span></div>
        <div class="info-row"><span class="info-label">ÙˆØ²Ù†</span><span class="info-val">{% if player.weight %}{{ player.weight }} kg{% else %}â€”{% endif %}</span></div>
        <div class="info-row"><span class="info-label">Ø¯Ø³Øª Ø¨Ø±ØªØ±</span><span class="info-val">{{ player.get_preferred_hand_display }}</span></div>
        <div class="info-row"><span class="info-label">Ù¾Ø§ÛŒ Ø¨Ø±ØªØ±</span><span class="info-val">{{ player.get_preferred_foot_display }}</span></div>
      </div>
      {% if player.medical_history %}
      <div style="margin-top:.5rem;padding:.6rem .85rem;background:#fef2f2;border-radius:8px;font-size:.82rem">
        <strong>Ø³Ø§Ø¨Ù‚Ù‡ Ù¾Ø²Ø´Ú©ÛŒ:</strong> {{ player.medical_history }}
      </div>
      {% endif %}
      {% if player.injury_history %}
      <div style="margin-top:.4rem;padding:.6rem .85rem;background:#fff7ed;border-radius:8px;font-size:.82rem">
        <strong>Ø³Ø§Ø¨Ù‚Ù‡ Ø¢Ø³ÛŒØ¨â€ŒØ¯ÛŒØ¯Ú¯ÛŒ:</strong> {{ player.injury_history }}
      </div>
      {% endif %}
    </div>
  </div>

  <!-- Ø¨ÛŒÙ…Ù‡ -->
  <div class="card">
    <div class="card-header"><span class="card-title">ğŸ›¡ï¸ Ø¨ÛŒÙ…Ù‡</span></div>
    <div style="padding:.75rem 1.25rem">
      <div class="info-row">
        <span class="info-label">ÙˆØ¶Ø¹ÛŒØª Ø¨ÛŒÙ…Ù‡</span>
        <span class="info-val">
          {% if player.insurance_status == 'active' %}
            <span class="badge badge-green">âœ… Ø¯Ø§Ø±Ø§ÛŒ Ø¨ÛŒÙ…Ù‡</span>
          {% else %}
            <span class="badge badge-red">âŒ Ø¨Ø¯ÙˆÙ† Ø¨ÛŒÙ…Ù‡</span>
          {% endif %}
        </span>
      </div>
      {% if player.insurance_expiry_date %}
      <div class="info-row"><span class="info-label">ØªØ§Ø±ÛŒØ® Ø§Ù†Ù‚Ø¶Ø§</span><span class="info-val">{{ player.insurance_expiry_date }}</span></div>
      {% endif %}
      {% if player.insurance_image %}
      <div style="margin-top:.75rem">
        <img src="{{ player.insurance_image.url }}" alt="Ø¨ÛŒÙ…Ù‡â€ŒÙ†Ø§Ù…Ù‡"
             style="max-width:100%;border-radius:8px;border:1px solid var(--surface-2)">
      </div>
      {% endif %}
    </div>
  </div>

</div><!-- /left -->

<!-- â”€â”€ Right: Actions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div>

  {% if player.status == 'pending' %}

  <!-- âœ… ÙØ±Ù… ØªØ£ÛŒÛŒØ¯ -->
  <div class="approve-panel">
    <div class="section-divider" style="color:#065f46">âœ… ØªØ£ÛŒÛŒØ¯ Ù…ØªÙ‚Ø§Ø¶ÛŒ</div>
    <form method="post" action="{% url 'registration:approve' player.pk %}">
      {% csrf_token %}

      <div style="margin-bottom:.85rem">
        <label style="font-size:.82rem;font-weight:700;display:block;margin-bottom:.35rem">Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§ÛŒ Ø¢Ù…ÙˆØ²Ø´ÛŒ</label>
        <div style="display:flex;flex-direction:column;gap:.3rem;max-height:180px;overflow-y:auto;padding:.35rem;border:1.5px solid #a7f3d0;border-radius:8px;background:#fff">
          {% for cat in categories %}
          <label style="display:flex;align-items:center;gap:.5rem;cursor:pointer;padding:.3rem .5rem;border-radius:6px;transition:background .1s"
                 onmouseenter="this.style.background='#f0fdf4'" onmouseleave="this.style.background=''">
            <input type="checkbox" name="category_ids" value="{{ cat.pk }}"
                   style="accent-color:var(--green)">
            <span style="font-size:.85rem;font-weight:600">{{ cat.name }}</span>
            <span style="font-size:.72rem;color:var(--text-muted);margin-right:auto">{{ cat.monthly_fee|floatformat:0 }} Ø±ÛŒØ§Ù„</span>
          </label>
          {% empty %}
          <div style="font-size:.82rem;color:var(--text-muted);padding:.5rem">Ù‡Ù†ÙˆØ² Ø¯Ø³ØªÙ‡â€ŒØ§ÛŒ ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡</div>
          {% endfor %}
        </div>
      </div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:.6rem;margin-bottom:.85rem">
        <div>
          <label style="font-size:.82rem;font-weight:700;display:block;margin-bottom:.3rem">Ù¾Ø³Øª</label>
          <select name="position" style="width:100%;padding:.5rem;border:1.5px solid #a7f3d0;border-radius:8px;font-family:inherit;font-size:.85rem">
            <option value="-">Ù…Ø´Ø®Øµ Ù†Ø´Ø¯Ù‡</option>
            <option value="pivot">Ù¾ÛŒÙˆØª</option>
            <option value="winger">ÙˆÛŒÙ†Ú¯Ø± / Ø¨Ø§Ù„</option>
            <option value="fixo">ÙÛŒÚ©Ø³Ùˆ</option>
            <option value="gk">Ø¯Ø±ÙˆØ§Ø²Ù‡â€ŒØ¨Ø§Ù†</option>
          </select>
        </div>
        <div>
          <label style="font-size:.82rem;font-weight:700;display:block;margin-bottom:.3rem">Ø³Ø·Ø­ Ù…Ù‡Ø§Ø±Øª</label>
          <select name="skill_level" style="width:100%;padding:.5rem;border:1.5px solid #a7f3d0;border-radius:8px;font-family:inherit;font-size:.85rem">
            <option value="">Ø§Ù†ØªØ®Ø§Ø¨</option>
            <option value="A">A</option><option value="B">B</option>
            <option value="C">C</option><option value="D">D</option>
            <option value="E">E</option><option value="F">F</option>
          </select>
        </div>
      </div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:.6rem;margin-bottom:.85rem">
        <div>
          <label style="font-size:.82rem;font-weight:700;display:block;margin-bottom:.3rem">Ø´Ù…Ø§Ø±Ù‡ Ù¾ÛŒØ±Ø§Ù‡Ù†</label>
          <input type="number" name="shirt_number" min="1" max="99"
                 style="width:100%;padding:.5rem;border:1.5px solid #a7f3d0;border-radius:8px;font-family:inherit;font-size:.85rem"
                 placeholder="Ù…Ø«Ø§Ù„: Û·">
        </div>
        <div style="display:flex;align-items:center;gap:.5rem;margin-top:1.5rem">
          <input type="checkbox" name="is_two_footed" id="two-footed" style="accent-color:var(--green)">
          <label for="two-footed" style="font-size:.85rem;font-weight:600;cursor:pointer">Ø¯ÙˆÙ¾Ø§</label>
        </div>
      </div>

      <button type="submit" class="btn btn-green" style="width:100%;justify-content:center;font-size:.95rem">
        âœ… ØªØ£ÛŒÛŒØ¯ Ùˆ Ø«Ø¨Øª Ø¯Ø± Ø³ÛŒØ³ØªÙ…
      </button>
    </form>
  </div>

  <!-- âŒ ÙØ±Ù… Ø±Ø¯ -->
  <div class="reject-panel">
    <div class="section-divider" style="color:#991b1b">âŒ Ø±Ø¯ Ù…ØªÙ‚Ø§Ø¶ÛŒ</div>
    <form method="post" action="{% url 'registration:reject' player.pk %}">
      {% csrf_token %}
      <div style="margin-bottom:.75rem">
        <label style="font-size:.82rem;font-weight:700;display:block;margin-bottom:.35rem">Ø¯Ù„ÛŒÙ„ Ø±Ø¯ <span style="color:var(--red)">*</span></label>
        <textarea name="rejection_reason" rows="3" required
                  style="width:100%;padding:.6rem .85rem;border:1.5px solid #fca5a5;border-radius:8px;font-family:inherit;font-size:.85rem;resize:vertical"
                  placeholder="Ø¯Ù„ÛŒÙ„ Ø±Ø¯ Ù…ØªÙ‚Ø§Ø¶ÛŒ Ø±Ø§ ØªÙˆØ¶ÛŒØ­ Ø¯Ù‡ÛŒØ¯..."></textarea>
      </div>
      <button type="submit" class="btn btn-red" style="width:100%;justify-content:center"
              onclick="return confirm('Ø¢ÛŒØ§ Ø§Ø² Ø±Ø¯ Ø§ÛŒÙ† Ù…ØªÙ‚Ø§Ø¶ÛŒ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ')">
        âŒ Ø±Ø¯ Ù…ØªÙ‚Ø§Ø¶ÛŒ
      </button>
    </form>
  </div>

  {% else %}
  <!-- Ø¨Ø§Ø²ÛŒÚ©Ù† Ù‚Ø¨Ù„Ø§Ù‹ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø´Ø¯Ù‡ -->
  <div class="card" style="padding:1.5rem;text-align:center">
    {% if player.status == 'approved' %}
    <div style="font-size:2.5rem;margin-bottom:.75rem">âœ…</div>
    <p style="font-weight:800;color:var(--green)">Ø§ÛŒÙ† Ø¨Ø§Ø²ÛŒÚ©Ù† ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡</p>
    <a href="{% url 'training:player-profile' player.pk %}" class="btn btn-outline" style="margin-top:1rem;display:inline-flex">
      ğŸ‘¤ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ú©Ø§Ù…Ù„
    </a>
    {% else %}
    <div style="font-size:2.5rem;margin-bottom:.75rem">âŒ</div>
    <p style="font-weight:800;color:var(--red)">Ø§ÛŒÙ† Ù…ØªÙ‚Ø§Ø¶ÛŒ Ø±Ø¯ Ø´Ø¯Ù‡</p>
    {% endif %}
  </div>

  {% if player.status == 'rejected' %}
  <!-- Ø§Ù…Ú©Ø§Ù† Ø¨Ø§Ø²Ø¨ÛŒÙ†ÛŒ Ùˆ ØªØ£ÛŒÛŒØ¯ Ù…Ø¬Ø¯Ø¯ -->
  <div class="approve-panel" style="margin-top:1rem">
    <div class="section-divider" style="color:#065f46">ğŸ”„ Ø¨Ø§Ø²Ø¨ÛŒÙ†ÛŒ Ùˆ ØªØ£ÛŒÛŒØ¯</div>
    <form method="post" action="{% url 'registration:approve' player.pk %}">
      {% csrf_token %}
      <div style="margin-bottom:.75rem">
        <label style="font-size:.82rem;font-weight:700;display:block;margin-bottom:.35rem">Ø¯Ø³ØªÙ‡ Ø¢Ù…ÙˆØ²Ø´ÛŒ</label>
        {% for cat in categories %}
        <label style="display:block;margin-bottom:.3rem;cursor:pointer;font-size:.85rem">
          <input type="checkbox" name="category_ids" value="{{ cat.pk }}" style="accent-color:var(--green)">
          {{ cat.name }}
        </label>
        {% endfor %}
      </div>
      <button type="submit" class="btn btn-green" style="width:100%;justify-content:center">
        âœ… ØªØ£ÛŒÛŒØ¯ Ù…Ø¬Ø¯Ø¯
      </button>
    </form>
  </div>
  {% endif %}
  {% endif %}

  <!-- Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ø³Ø±ÛŒØ¹ -->
  <div class="card" style="padding:.85rem 1rem;margin-top:1rem">
    <div style="font-size:.78rem;font-weight:700;color:var(--text-muted);margin-bottom:.6rem">Ø¯Ø³ØªØ±Ø³ÛŒ Ø³Ø±ÛŒØ¹</div>
    <div style="display:flex;flex-direction:column;gap:.4rem">
      <a href="{% url 'registration:applicant-list' %}" class="btn btn-outline btn-sm">â† Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù„ÛŒØ³Øª</a>
      {% if player.status == 'approved' %}
      <a href="{% url 'registration:archive-player' player.pk %}"
         class="btn btn-sm" style="border:1.5px solid var(--text-muted);color:var(--text-muted)"
         onclick="return confirm('Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§ÛŒÙ† Ø¨Ø§Ø²ÛŒÚ©Ù† Ø±Ø§ Ø¢Ø±Ø´ÛŒÙˆ Ú©Ù†ÛŒØ¯ØŸ')">
        ğŸ—„ï¸ Ø¢Ø±Ø´ÛŒÙˆ Ø¨Ø§Ø²ÛŒÚ©Ù†
      </a>
      {% endif %}
    </div>
  </div>

</div><!-- /right -->
</div><!-- /grid -->

{% endblock %}
