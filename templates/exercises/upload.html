{% extends "base.html" %}
{% block title %}Ø¢Ù¾Ù„ÙˆØ¯ ØªÙ…Ø±ÛŒÙ† Ø¬Ø¯ÛŒØ¯{% endblock %}
{% block nav_exercises %}active{% endblock %}

{% block breadcrumb %}
  <span class="sep">â€º</span>
  <a href="{% url 'exercises:gallery' %}" style="text-decoration:none;color:inherit">Ù…Ø®Ø²Ù† ØªÙ…Ø±ÛŒÙ†â€ŒÙ‡Ø§</a>
  <span class="sep">â€º</span><span class="cur">ØªÙ…Ø±ÛŒÙ† Ø¬Ø¯ÛŒØ¯</span>
{% endblock %}

{% block extra_head %}
<style>
.drop-zone {
  border: 2px dashed var(--surface-2); border-radius: var(--radius);
  padding: 3rem 2rem; text-align: center; cursor: pointer;
  transition: var(--transition); background: var(--surface); position: relative;
}
.drop-zone:hover, .drop-zone.drag-over { border-color: var(--amber); background: #fffbeb; }
.drop-zone input[type=file] { position: absolute; inset: 0; opacity: 0; cursor: pointer; width: 100%; height: 100%; }
.type-card {
  display: flex; flex-direction: column; align-items: center; gap: .4rem;
  padding: .85rem; border: 2px solid var(--surface-2); border-radius: 10px;
  cursor: pointer; transition: .15s; font-size: .8rem; font-weight: 700; color: var(--text-muted);
}
.type-card:hover { border-color: var(--amber); color: var(--navy); }
.type-card.selected { border-color: var(--amber); background: #fffbeb; color: var(--navy); }
.type-card .icon { font-size: 1.6rem; }
</style>
{% endblock %}

{% block content %}
<div style="max-width:640px;margin:0 auto">
  <div class="card" style="padding:0;overflow:hidden">
    <div style="height:4px;background:linear-gradient(90deg,var(--amber),var(--teal))"></div>
    <div style="padding:1.5rem 1.75rem">

      <div style="display:flex;align-items:center;gap:.75rem;margin-bottom:1.5rem">
        <div style="width:42px;height:42px;background:linear-gradient(135deg,var(--amber),var(--navy));border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.2rem">ğŸ‹ï¸</div>
        <div>
          <h1 style="font-size:1.1rem;font-weight:900;color:var(--navy)">Ø¢Ù¾Ù„ÙˆØ¯ ØªÙ…Ø±ÛŒÙ† Ø¬Ø¯ÛŒØ¯</h1>
          <p style="font-size:.78rem;color:var(--text-muted)">ÙˆÛŒØ¯ÛŒÙˆØŒ ØªØµÙˆÛŒØ±ØŒ Ú¯ÛŒÙ ÛŒØ§ Ø³Ù†Ø¯ Ø¢Ù…ÙˆØ²Ø´ÛŒ</p>
        </div>
      </div>

      {% if form.errors %}
      <div style="background:#fee2e2;border:1.5px solid #fca5a5;border-radius:10px;padding:.85rem 1rem;margin-bottom:1.25rem;font-size:.85rem;color:#991b1b">
        âš ï¸ {% for field in form %}{% for err in field.errors %}<div>â€¢ {{ field.label }}: {{ err }}</div>{% endfor %}{% endfor %}
      </div>
      {% endif %}

      <form method="post" enctype="multipart/form-data" id="upload-form">
        {% csrf_token %}

        <!-- Ù†ÙˆØ¹ Ø±Ø³Ø§Ù†Ù‡ -->
        <div style="margin-bottom:1.25rem">
          <label style="font-size:.85rem;font-weight:700;display:block;margin-bottom:.6rem">Ù†ÙˆØ¹ ÙØ§ÛŒÙ„ <span style="color:var(--red)">*</span></label>
          <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:.5rem">
            {% for val, lbl in form.media_type.field.choices %}
            <label class="type-card {% if forloop.first %}selected{% endif %}" id="tc-{{ val }}"
                   onclick="selectType('{{ val }}')">
              <span class="icon">
                {% if val == 'video' %}ğŸ¬{% elif val == 'image' %}ğŸ–¼ï¸{% elif val == 'gif' %}âœ¨{% else %}ğŸ“„{% endif %}
              </span>
              <input type="radio" name="media_type" value="{{ val }}" {% if forloop.first %}checked{% endif %}
                     style="display:none">
              {{ lbl }}
            </label>
            {% endfor %}
          </div>
        </div>

        <!-- Ø¹Ù†ÙˆØ§Ù† -->
        <div style="margin-bottom:1rem">
          <label style="font-size:.85rem;font-weight:700;display:block;margin-bottom:.3rem">Ø¹Ù†ÙˆØ§Ù† ØªÙ…Ø±ÛŒÙ† <span style="color:var(--red)">*</span></label>
          {{ form.title }}
        </div>

        <!-- ØªÙˆØ¶ÛŒØ­Ø§Øª -->
        <div style="margin-bottom:1rem">
          <label style="font-size:.85rem;font-weight:700;display:block;margin-bottom:.3rem">ØªÙˆØ¶ÛŒØ­Ø§Øª</label>
          {{ form.description }}
        </div>

        <!-- Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„ -->
        <div style="margin-bottom:1.25rem">
          <label style="font-size:.85rem;font-weight:700;display:block;margin-bottom:.5rem">ÙØ§ÛŒÙ„ ØªÙ…Ø±ÛŒÙ† <span style="color:var(--red)">*</span></label>
          <div class="drop-zone" id="drop-zone">
            {{ form.file }}
            <div style="font-size:2.5rem;margin-bottom:.5rem" id="drop-icon">ğŸ“‚</div>
            <div style="font-weight:700;font-size:.9rem" id="drop-title">ÙØ§ÛŒÙ„ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø±Ù‡Ø§ Ú©Ù†ÛŒØ¯ ÛŒØ§ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯</div>
            <div style="font-size:.78rem;color:var(--text-muted);margin-top:.3rem">
              Ø­Ø¯Ø§Ú©Ø«Ø± Û²Û°Û° Ù…Ú¯Ø§Ø¨Ø§ÛŒØª | MP4, JPG, PNG, GIF, PDF, DOCX
            </div>
          </div>
          <div id="file-chosen" style="display:none;margin-top:.5rem;padding:.6rem .85rem;background:#d1fae5;border-radius:8px;font-size:.85rem;color:#065f46;font-weight:600"></div>
          {% if form.file.errors %}<div style="font-size:.72rem;color:var(--red);margin-top:.2rem">{{ form.file.errors.0 }}</div>{% endif %}
        </div>

        <!-- Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§ÛŒ Ù…Ø±ØªØ¨Ø· -->
        {% if form.categories.field.choices %}
        <div style="margin-bottom:1.25rem">
          <label style="font-size:.85rem;font-weight:700;display:block;margin-bottom:.5rem">Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§ÛŒ Ù…Ø±ØªØ¨Ø·</label>
          <div style="display:flex;flex-wrap:wrap;gap:.4rem">
            {% for val, lbl in form.categories.field.choices %}
            <label style="display:flex;align-items:center;gap:.4rem;padding:.35rem .75rem;border:1.5px solid var(--surface-2);border-radius:99px;cursor:pointer;font-size:.8rem;transition:.15s"
                   onmouseenter="this.style.borderColor='var(--navy)'" onmouseleave="this.style.borderColor=''">
              <input type="checkbox" name="categories" value="{{ val }}" style="accent-color:var(--navy)">
              {{ lbl }}
            </label>
            {% endfor %}
          </div>
        </div>
        {% endif %}

        <!-- Ø¯Ø³ØªØ±Ø³ÛŒ -->
        <div style="margin-bottom:1.5rem;padding:.85rem 1rem;border:1.5px solid var(--surface-2);border-radius:10px">
          <label style="display:flex;align-items:center;gap:.75rem;cursor:pointer">
            {{ form.is_public }}
            <div>
              <div style="font-weight:700;font-size:.875rem">ğŸŒ Ù‚Ø§Ø¨Ù„ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ù‡Ù…Ù‡ Ù…Ø±Ø¨ÛŒØ§Ù†</div>
              <div style="font-size:.75rem;color:var(--text-muted);margin-top:.15rem">
                Ø§Ú¯Ø± ÙØ¹Ø§Ù„ Ø¨Ø§Ø´Ø¯ Ø³Ø§ÛŒØ± Ù…Ø±Ø¨ÛŒØ§Ù† Ù‡Ù… Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù†Ø¯ Ø§ÛŒÙ† ØªÙ…Ø±ÛŒÙ† Ø±Ø§ Ø¨Ø¨ÛŒÙ†Ù†Ø¯
              </div>
            </div>
          </label>
        </div>

        <div style="background:#f0fdf4;border:1px solid #a7f3d0;border-radius:8px;padding:.65rem .85rem;margin-bottom:1.25rem;font-size:.8rem;color:#065f46">
          ğŸ’¡ ØªØµÙˆÛŒØ± Ø¨Ù†Ø¯Ø§Ù†Ú¯Ø´ØªÛŒ Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± ØªÙˆØ³Ø· Ø³ÛŒØ³ØªÙ… Ø³Ø§Ø®ØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.
        </div>

        <div style="display:flex;gap:.6rem;justify-content:flex-end">
          <a href="{% url 'exercises:gallery' %}" class="btn btn-outline">Ø§Ù†ØµØ±Ø§Ù</a>
          <button type="submit" class="btn btn-amber" id="submit-btn">ğŸ“¤ Ø¢Ù¾Ù„ÙˆØ¯ ØªÙ…Ø±ÛŒÙ†</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
function selectType(val) {
  document.querySelectorAll('.type-card').forEach(c => c.classList.remove('selected'));
  const card = document.getElementById('tc-' + val);
  if (card) { card.classList.add('selected'); card.querySelector('input').checked = true; }
  // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¢ÛŒÚ©ÙˆÙ† drop zone
  const icons = { video:'ğŸ¬', image:'ğŸ–¼ï¸', gif:'âœ¨', document:'ğŸ“„' };
  const di = document.getElementById('drop-icon');
  if (di) di.textContent = icons[val] || 'ğŸ“‚';
}

// File chosen feedback
document.getElementById('{{ form.file.id_for_label }}')?.addEventListener('change', function() {
  const f = this.files[0];
  if (!f) return;
  const el = document.getElementById('file-chosen');
  el.style.display = 'block';
  el.textContent = 'âœ… ' + f.name + ' (' + (f.size / 1024 / 1024).toFixed(2) + ' MB)';
});

// Drag & Drop
const dz = document.getElementById('drop-zone');
dz?.addEventListener('dragover',  e => { e.preventDefault(); dz.classList.add('drag-over'); });
dz?.addEventListener('dragleave', () => dz.classList.remove('drag-over'));
dz?.addEventListener('drop',      e => {
  e.preventDefault(); dz.classList.remove('drag-over');
  const fi = dz.querySelector('input[type=file]');
  if (fi && e.dataTransfer.files.length) { fi.files = e.dataTransfer.files; fi.dispatchEvent(new Event('change')); }
});

// Submit feedback
document.getElementById('upload-form')?.addEventListener('submit', function() {
  const btn = document.getElementById('submit-btn');
  setTimeout(() => { btn.disabled = true; btn.textContent = 'â³ Ø¯Ø± Ø­Ø§Ù„ Ø¢Ù¾Ù„ÙˆØ¯...'; }, 50);
});
</script>
{% endblock %}