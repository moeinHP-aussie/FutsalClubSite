{% extends "base.html" %}
{% load attendance_extras %}
{% block title %}ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø­Ø¶ÙˆØ± â€” {{ player.first_name }} {{ player.last_name }}{% endblock %}
{% block nav_notifications %}{% endblock %}

{% block breadcrumb %}
  <span class="sep">/</span>
  {% if request.user.is_player %}
  <a href="{% url 'training:my-profile' %}" style="text-decoration:none;color:inherit">{{ player.first_name }} {{ player.last_name }}</a>
  {% else %}
  <a href="{% url 'training:player-profile' player.pk %}" style="text-decoration:none;color:inherit">{{ player.first_name }} {{ player.last_name }}</a>
  {% endif %}
  <span class="sep">/</span>
  <span class="cur">ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø­Ø¶ÙˆØ±</span>
{% endblock %}

{% block content %}

<!-- â”€â”€ Ù‡Ø¯Ø± â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="page-header">
  <div style="display:flex;align-items:center;gap:1rem">
    <div style="width:52px;height:52px;border-radius:50%;background:linear-gradient(135deg,var(--teal),var(--navy));display:flex;align-items:center;justify-content:center;font-size:1.25rem;font-weight:800;color:#fff;flex-shrink:0">
      {{ player.first_name|slice:":1" }}{{ player.last_name|slice:":1" }}
    </div>
    <div>
      <h1 style="font-size:1.35rem">ğŸ“… ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø­Ø¶ÙˆØ± Ùˆ ØºÛŒØ§Ø¨</h1>
      <p style="color:var(--text-muted);margin-top:.15rem">{{ player.first_name }} {{ player.last_name }}</p>
    </div>
  </div>
  {% if request.user.is_player %}
  <a href="{% url 'training:my-profile' %}" class="btn btn-outline btn-sm">â† Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ù…Ù†</a>
{% else %}
  <a href="{% url 'training:player-profile' player.pk %}" class="btn btn-outline btn-sm">â† Ù¾Ø±ÙˆÙØ§ÛŒÙ„</a>
{% endif %}
</div>

<!-- â”€â”€ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù‡ÙØªÚ¯ÛŒ ØªÙ…Ø±ÛŒÙ†â€ŒÙ‡Ø§ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
{% if schedules %}
<div class="card mb-2">
  <div class="card-header">
    <span class="card-title">ğŸ—“ï¸ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù‡ÙØªÚ¯ÛŒ ØªÙ…Ø±ÛŒÙ†</span>
  </div>
  <div class="table-wrap">
    <table class="data-table">
      <thead>
        <tr>
          <th>Ø±ÙˆØ²</th>
          <th>Ø³Ø§Ø¹Øª Ø´Ø±ÙˆØ¹</th>
          <th>Ø³Ø§Ø¹Øª Ù¾Ø§ÛŒØ§Ù†</th>
          <th>Ù…Ú©Ø§Ù† / Ø³Ø§Ù„Ù†</th>
          <th>Ø¯Ø³ØªÙ‡ Ø¢Ù…ÙˆØ²Ø´ÛŒ</th>
        </tr>
      </thead>
      <tbody>
        {% for sch in schedules %}
        <tr>
          <td><strong>{{ sch.get_weekday_display }}</strong></td>
          <td style="font-family:monospace">{{ sch.start_time|time:"H:i" }}</td>
          <td style="font-family:monospace">
            {% if sch.end_time %}{{ sch.end_time|time:"H:i" }}{% else %}<span style="color:var(--text-light)">â€”</span>{% endif %}
          </td>
          <td>
            {% if sch.location %}
              <span style="font-size:.82rem">ğŸ“ {{ sch.location }}</span>
            {% else %}
              <span style="color:var(--text-light)">â€”</span>
            {% endif %}
          </td>
          <td><span class="badge badge-navy">{{ sch.category.name }}</span></td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endif %}

<!-- â”€â”€ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù…Ø§Ù‡Ø§Ù†Ù‡ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div style="margin-bottom:.75rem">
  <h2 style="font-size:1rem;font-weight:700;color:var(--text-main)">ğŸ“Š Ø¢Ù…Ø§Ø± Ø­Ø¶ÙˆØ± Û¶ Ù…Ø§Ù‡ Ú¯Ø°Ø´ØªÙ‡</h2>
</div>

{% for item in months_data %}
{% with month=item.month stats=item.stats %}

<div class="card mb-2">
  <div class="card-header">
    <span class="card-title">{{ month.persian_name }} {{ month.year }}</span>
    {% if stats %}
      {% comment %}Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¬Ù…Ø¹ Ú©Ù„ Ø§ÛŒÙ† Ù…Ø§Ù‡{% endcomment %}
      {% with total_p=0 total_s=0 %}
      <span style="font-size:.78rem;color:var(--text-muted)">{{ stats|length }} Ø¯Ø³ØªÙ‡</span>
      {% endwith %}
    {% endif %}
  </div>

  {% if stats %}
  <div style="padding:.75rem 1.25rem">
    {% for cat_name, stat in stats.items %}
    <div style="{% if not forloop.last %}border-bottom:1px solid var(--surface-2);margin-bottom:.85rem;padding-bottom:.85rem{% endif %}">

      <div style="font-size:.82rem;font-weight:700;color:var(--navy);margin-bottom:.45rem">
        ğŸ·ï¸ {{ cat_name }}
      </div>

      {% if stat %}
        {% if stat.total > 0 %}
          {% with pct=stat.present|widthratio_int:stat.total %}
          <div style="display:flex;align-items:center;gap:.5rem;flex-wrap:wrap;margin-bottom:.4rem">
            <span class="badge badge-green">âœ… {{ stat.present }} Ø­Ø§Ø¶Ø±</span>
            <span class="badge badge-red">âŒ {{ stat.absent }} ØºØ§ÛŒØ¨</span>
            {% if stat.excused %}<span class="badge badge-amber">âš ï¸ {{ stat.excused }} Ù…ÙˆØ¬Ù‡</span>{% endif %}
            <span class="badge badge-gray">ğŸ“‹ Ø§Ø² {{ stat.total }} Ø¬Ù„Ø³Ù‡</span>
          </div>
          <div style="display:flex;align-items:center;gap:.6rem">
            <div style="flex:1;height:10px;background:var(--surface-2);border-radius:99px;overflow:hidden;max-width:260px">
              <div style="height:100%;width:{{ pct }}%;background:{% if pct >= 75 %}var(--green){% elif pct >= 50 %}var(--amber){% else %}var(--red){% endif %};border-radius:99px;transition:width .4s"></div>
            </div>
            <span style="font-size:.8rem;font-weight:700;
              color:{% if pct >= 75 %}var(--green){% elif pct >= 50 %}var(--amber){% else %}var(--red){% endif %}">
              {{ pct }}Ùª
            </span>
          </div>
          {% endwith %}
        {% else %}
          <span style="font-size:.8rem;color:var(--text-muted)">Ø¬Ù„Ø³Ù‡â€ŒØ§ÛŒ Ø¯Ø± Ø§ÛŒÙ† Ù…Ø§Ù‡ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡.</span>
        {% endif %}
      {% else %}
        <span style="font-size:.8rem;color:var(--text-muted)">Ù„ÛŒØ³Øª Ø­Ø¶ÙˆØ± Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</span>
      {% endif %}

    </div>
    {% endfor %}
  </div>
  {% else %}
  <div style="padding:1.25rem;text-align:center;color:var(--text-muted);font-size:.85rem">
    Ø¯Ø± Ø§ÛŒÙ† Ù…Ø§Ù‡ Ø¯Ø³ØªÙ‡ ÙØ¹Ø§Ù„ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯ ÛŒØ§ Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡.
  </div>
  {% endif %}

</div>

{% endwith %}
{% endfor %}

{% if not months_data %}
<div class="card">
  <div style="padding:2.5rem;text-align:center;color:var(--text-muted)">
    <div style="font-size:2.5rem;margin-bottom:.75rem">ğŸ“­</div>
    <p>Ù‡Ù†ÙˆØ² Ø³Ø§Ø¨Ù‚Ù‡ Ø­Ø¶ÙˆØ± Ùˆ ØºÛŒØ§Ø¨ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</p>
  </div>
</div>
{% endif %}

{% endblock %}
