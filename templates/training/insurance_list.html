{% extends "base.html" %}
{% block title %}ÙˆØ¶Ø¹ÛŒØª Ø¨ÛŒÙ…Ù‡ Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù†{% endblock %}
{% block nav_stats %}active{% endblock %}

{% block breadcrumb %}
  <span class="sep">â€º</span>
  <a href="{% url 'training:stats' %}" style="text-decoration:none;color:inherit">Ø¢Ù…Ø§Ø±Ú¯ÛŒØ±ÛŒ</a>
  <span class="sep">â€º</span>
  <span class="cur">ÙˆØ¶Ø¹ÛŒØª Ø¨ÛŒÙ…Ù‡</span>
{% endblock %}

{% block extra_head %}
<style>
/* â”€â”€ Tab Bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.ins-tabs {
  display: flex; gap: .4rem; flex-wrap: wrap;
  background: var(--surface);
  border-radius: 12px; padding: .4rem;
  margin-bottom: 1.5rem;
}
.ins-tab {
  flex: 1; min-width: 120px;
  display: flex; flex-direction: column; align-items: center;
  padding: .75rem 1rem; border-radius: 9px; cursor: pointer;
  text-decoration: none; transition: background .18s, box-shadow .18s;
  border: 2px solid transparent;
  gap: .25rem;
}
.ins-tab:hover { background: var(--white); box-shadow: var(--shadow-sm); }
.ins-tab.active { background: var(--white); box-shadow: var(--shadow); border-color: var(--current-color, var(--navy)); }
.ins-tab .tab-num { font-size: 1.6rem; font-weight: 900; line-height: 1; }
.ins-tab .tab-label { font-size: .72rem; color: var(--text-muted); font-weight: 600; }

.tab-none    { --current-color: #ef4444; }
.tab-expired { --current-color: #dc2626; }
.tab-expiring{ --current-color: #f59e0b; }
.tab-active  { --current-color: #10b981; }

.tab-none .tab-num    { color: #ef4444; }
.tab-expired .tab-num { color: #dc2626; }
.tab-expiring .tab-num{ color: #f59e0b; }
.tab-active .tab-num  { color: #10b981; }

/* â”€â”€ Player Cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.ins-player-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
  gap: 1rem;
}
.ins-card {
  background: var(--white);
  border: 1px solid var(--surface-2);
  border-radius: var(--radius);
  padding: 1rem 1.1rem;
  display: flex; gap: .9rem; align-items: center;
  transition: box-shadow .18s, transform .12s;
  position: relative;
  overflow: hidden;
}
.ins-card:hover { box-shadow: var(--shadow); transform: translateY(-1px); }
.ins-card::before {
  content: "";
  position: absolute; right: 0; top: 0; bottom: 0;
  width: 4px; border-radius: 0 var(--radius) var(--radius) 0;
  background: var(--stripe-color, var(--navy));
}
.ins-card.c-none    { --stripe-color: #ef4444; }
.ins-card.c-expired { --stripe-color: #dc2626; }
.ins-card.c-expiring{ --stripe-color: #f59e0b; }
.ins-card.c-active  { --stripe-color: #10b981; }

.ins-avatar {
  width: 44px; height: 44px; border-radius: 50%; flex-shrink: 0;
  background: linear-gradient(135deg, var(--teal), var(--navy));
  display: flex; align-items: center; justify-content: center;
  font-size: .9rem; font-weight: 700; color: var(--white);
}
.ins-name { font-size: .95rem; font-weight: 700; color: var(--text-main); }
.ins-cats {
  display: flex; flex-wrap: wrap; gap: .25rem; margin-top: .3rem;
}
.ins-cat-badge {
  font-size: .68rem; padding: .1rem .45rem; border-radius: 20px;
  background: var(--surface); color: var(--text-muted); font-weight: 600;
}
.ins-meta {
  margin-right: auto; text-align: left; flex-shrink: 0;
}
.ins-date {
  font-size: .78rem; font-weight: 700;
}
.ins-days {
  font-size: .7rem; color: var(--text-muted); margin-top: .15rem;
}
.days-expired  { color: #dc2626; }
.days-expiring { color: #d97706; }
.days-ok       { color: #059669; }

/* â”€â”€ Empty State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.empty-ins {
  text-align: center; padding: 4rem 2rem; color: var(--text-muted);
}
.empty-ins .ei-icon { font-size: 3rem; margin-bottom: 1rem; }
.empty-ins h3 { font-size: 1.1rem; margin-bottom: .5rem; }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
  <div>
    <h1>ğŸ›¡ï¸ ÙˆØ¶Ø¹ÛŒØª Ø¨ÛŒÙ…Ù‡ Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù†</h1>
    <p>Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª ÙˆØ¶Ø¹ÛŒØª Ø¨ÛŒÙ…Ù‡</p>
  </div>
  <a href="{% url 'training:stats' %}" class="btn btn-outline">â† Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø¢Ù…Ø§Ø±Ú¯ÛŒØ±ÛŒ</a>
</div>

<!-- â”€â”€ Tab Bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="ins-tabs">
  <a href="?status=none"
     class="ins-tab tab-none {% if status_filter == 'none' %}active{% endif %}">
    <span class="tab-num">{{ ins_none_count }}</span>
    <span class="tab-label">âŒ Ø¨Ø¯ÙˆÙ† Ø¨ÛŒÙ…Ù‡</span>
  </a>
  <a href="?status=expired"
     class="ins-tab tab-expired {% if status_filter == 'expired' %}active{% endif %}">
    <span class="tab-num">{{ ins_expired_count }}</span>
    <span class="tab-label">ğŸš¨ Ø¨ÛŒÙ…Ù‡ Ù…Ù†Ù‚Ø¶ÛŒ</span>
  </a>
  <a href="?status=expiring"
     class="ins-tab tab-expiring {% if status_filter == 'expiring' %}active{% endif %}">
    <span class="tab-num">{{ ins_expiring_count }}</span>
    <span class="tab-label">âš ï¸ Ø±Ùˆ Ø¨Ù‡ Ø§Ù†Ù‚Ø¶Ø§ (Û³Û° Ø±ÙˆØ²)</span>
  </a>
  <a href="?status=active"
     class="ins-tab tab-active {% if status_filter == 'active' %}active{% endif %}">
    <span class="tab-num">{{ ins_active_count }}</span>
    <span class="tab-label">âœ… Ø¨ÛŒÙ…Ù‡ ÙØ¹Ø§Ù„</span>
  </a>
</div>

<!-- â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div style="display:flex;align-items:center;gap:.75rem;margin-bottom:1rem">
  <div style="font-size:.85rem;color:var(--text-muted)">
    {% if status_filter == 'none' %}Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù†ÛŒ Ú©Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨ÛŒÙ…Ù‡â€ŒØ§ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡:
    {% elif status_filter == 'expired' %}Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù†ÛŒ Ú©Ù‡ Ø¨ÛŒÙ…Ù‡â€ŒØ´Ø§Ù† Ù…Ù†Ù‚Ø¶ÛŒ Ø´Ø¯Ù‡:
    {% elif status_filter == 'expiring' %}Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù†ÛŒ Ú©Ù‡ Ø¨ÛŒÙ…Ù‡â€ŒØ´Ø§Ù† Ø¸Ø±Ù Û³Û° Ø±ÙˆØ² Ù…Ù†Ù‚Ø¶ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯:
    {% else %}Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù†ÛŒ Ú©Ù‡ Ø¨ÛŒÙ…Ù‡ ÙØ¹Ø§Ù„ Ùˆ Ù…Ø¹ØªØ¨Ø± Ø¯Ø§Ø±Ù†Ø¯:
    {% endif %}
    <strong>{{ player_count }} Ù†ÙØ±</strong>
  </div>
  {% if player_count %}
  <a href="?status={{ status_filter }}&export=csv" class="btn btn-outline btn-sm" style="margin-right:auto">
    ğŸ“¥ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø§Ú©Ø³Ù„
  </a>
  {% endif %}
</div>

{% if player_data %}
<!-- â”€â”€ Player Cards Grid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="ins-player-grid">
  {% for item in player_data %}
  <div class="ins-card c-{{ status_filter }}">
    <div class="ins-avatar">
      {{ item.player.first_name|slice:":1" }}{{ item.player.last_name|slice:":1" }}
    </div>
    <div style="flex:1;min-width:0">
      <div class="ins-name">
        <a href="{% url 'training:player-profile' item.player.pk %}"
           style="text-decoration:none;color:inherit;hover:underline">
          {{ item.player.first_name }} {{ item.player.last_name }}
        </a>
      </div>
      <div class="ins-cats">
        {% for cat in item.cats %}
          <span class="ins-cat-badge">{{ cat.name }}</span>
        {% empty %}
          <span class="ins-cat-badge" style="color:#94a3b8">Ø¨Ø¯ÙˆÙ† Ø¯Ø³ØªÙ‡</span>
        {% endfor %}
      </div>
    </div>
    <div class="ins-meta">
      {% if item.player.insurance_expiry_date %}
        <div class="ins-date">
          {{ item.player.insurance_expiry_date }}
        </div>
        {% if item.days_left is not None %}
          {% if item.days_left < 0 %}
            <div class="ins-days days-expired">{{ item.days_left|cut:"-" }} Ø±ÙˆØ² Ù¾ÛŒØ´ Ù…Ù†Ù‚Ø¶ÛŒ Ø´Ø¯</div>
          {% elif item.days_left == 0 %}
            <div class="ins-days days-expired">Ø§Ù…Ø±ÙˆØ² Ù…Ù†Ù‚Ø¶ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯</div>
          {% elif item.days_left <= 7 %}
            <div class="ins-days days-expiring">{{ item.days_left }} Ø±ÙˆØ² Ø¯ÛŒÚ¯Ø±</div>
          {% elif item.days_left <= 30 %}
            <div class="ins-days days-expiring">{{ item.days_left }} Ø±ÙˆØ² Ø¯ÛŒÚ¯Ø±</div>
          {% else %}
            <div class="ins-days days-ok">{{ item.days_left }} Ø±ÙˆØ² Ø¯ÛŒÚ¯Ø±</div>
          {% endif %}
        {% endif %}
      {% else %}
        <div class="ins-date" style="color:var(--text-light)">â€”</div>
        <div class="ins-days">ØªØ§Ø±ÛŒØ® Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡</div>
      {% endif %}
    </div>
  </div>
  {% endfor %}
</div>

{% else %}
<!-- â”€â”€ Empty State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="card">
  <div class="empty-ins">
    <div class="ei-icon">
      {% if status_filter == 'none' %}âœ…
      {% elif status_filter == 'expired' %}ğŸ‰
      {% elif status_filter == 'expiring' %}âœ…
      {% else %}ğŸ›¡ï¸
      {% endif %}
    </div>
    <h3>
      {% if status_filter == 'none' %}Ù‡Ù…Ù‡ Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† Ø¨ÛŒÙ…Ù‡ Ø¯Ø§Ø±Ù†Ø¯!
      {% elif status_filter == 'expired' %}Ù‡ÛŒÚ† Ø¨ÛŒÙ…Ù‡ Ù…Ù†Ù‚Ø¶ÛŒâ€ŒØ´Ø¯Ù‡â€ŒØ§ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯
      {% elif status_filter == 'expiring' %}Ù‡ÛŒÚ† Ø¨ÛŒÙ…Ù‡ Ø±Ùˆ Ø¨Ù‡ Ø§Ù†Ù‚Ø¶Ø§ÛŒÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯
      {% else %}Ù‡ÛŒÚ† Ø¨Ø§Ø²ÛŒÚ©Ù†ÛŒ Ø¨Ø§ Ø¨ÛŒÙ…Ù‡ ÙØ¹Ø§Ù„ ÛŒØ§ÙØª Ù†Ø´Ø¯
      {% endif %}
    </h3>
    <p style="margin-top:.5rem;font-size:.875rem">
      {% if status_filter == 'none' %}ÙˆØ¶Ø¹ÛŒØª Ø¨ÛŒÙ…Ù‡ Ù‡Ù…Ù‡ Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† Ø¯Ø± Ø³ÛŒØ³ØªÙ… Ø«Ø¨Øª Ø´Ø¯Ù‡.
      {% elif status_filter == 'expired' %}Ø¨ÛŒÙ…Ù‡ ØªÙ…Ø§Ù…ÛŒ Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª.
      {% elif status_filter == 'expiring' %}Ù‡ÛŒÚ† Ø¨ÛŒÙ…Ù‡â€ŒØ§ÛŒ Ø¯Ø± Ù…Ø§Ù‡ Ø¢ÛŒÙ†Ø¯Ù‡ Ù…Ù†Ù‚Ø¶ÛŒ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯.
      {% endif %}
    </p>
  </div>
</div>
{% endif %}

{% endblock %}