{% extends "base.html" %}
{% block title %}Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù†{% endblock %}
{% block nav_players %}active{% endblock %}

{% block breadcrumb %}
  <span class="sep">â€º</span><span class="cur">Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù†</span>
{% endblock %}

{% block content %}

<div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:.75rem;margin-bottom:1.25rem">
  <div>
    <h1 style="font-size:1.25rem;font-weight:900;color:var(--navy)">ğŸ‘¥ Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù†</h1>
    <p style="font-size:.82rem;color:var(--text-muted);margin-top:.2rem">{{ total_count }} Ø¨Ø§Ø²ÛŒÚ©Ù† ØªØ£ÛŒÛŒØ¯Ø´Ø¯Ù‡</p>
  </div>
  <div style="display:flex;gap:.5rem">
    <a href="{% url 'registration:applicant-list' %}" class="btn btn-outline btn-sm">ğŸ“‹ Ù…ØªÙ‚Ø§Ø¶ÛŒØ§Ù† Ø¬Ø¯ÛŒØ¯</a>
    <a href="{% url 'registration:bulk-import' %}" class="btn btn-navy btn-sm">ğŸ“¥ Ø§ÛŒÙ…Ù¾ÙˆØ±Øª Ø§Ú©Ø³Ù„</a>
  </div>
</div>

<!-- Filter -->
<div class="card" style="padding:.85rem 1rem;margin-bottom:1rem">
  <form method="get" style="display:flex;gap:.6rem;flex-wrap:wrap;align-items:center">
    <input type="text" name="q" value="{{ q }}"
           placeholder="Ù†Ø§Ù…ØŒ Ú©Ø¯ Ù…Ù„ÛŒØŒ Ù…ÙˆØ¨Ø§ÛŒÙ„..."
           style="padding:.55rem .85rem;border:1.5px solid var(--surface-2);border-radius:8px;font-family:inherit;font-size:.875rem;flex:1;min-width:180px">
    <select name="category"
            style="padding:.55rem .75rem;border:1.5px solid var(--surface-2);border-radius:8px;font-family:inherit;font-size:.875rem">
      <option value="">Ù‡Ù…Ù‡ Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§</option>
      {% for cat in all_categories %}
      <option value="{{ cat.pk }}" {% if category_filter == cat.pk|stringformat:"i" %}selected{% endif %}>{{ cat.name }}</option>
      {% endfor %}
    </select>
    <button type="submit" class="btn btn-primary btn-sm">ğŸ” Ø¬Ø³ØªØ¬Ùˆ</button>
    {% if q or category_filter %}<a href="?" class="btn btn-outline btn-sm">âœ• Ù¾Ø§Ú©</a>{% endif %}
  </form>
</div>

<!-- Table -->
{% if players %}
<div class="card">
  <div class="table-wrap">
    <table class="data-table">
      <thead>
        <tr>
          <th>#</th>
          <th>Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</th>
          <th>Ú©Ø¯ Ù…Ù„ÛŒ</th>
          <th>Ù…ÙˆØ¨Ø§ÛŒÙ„</th>
          <th>Ù¾Ø¯Ø±</th>
          <th>Ø¯Ø³ØªÙ‡</th>
          <th>Ø¨ÛŒÙ…Ù‡</th>
          <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
        </tr>
      </thead>
      <tbody>
        {% for player in players %}
        <tr>
          <td style="color:var(--text-muted);font-size:.8rem">
            {{ page_obj.start_index|add:forloop.counter0 }}
          </td>
          <td>
            <strong>{{ player.first_name }} {{ player.last_name }}</strong>
            <div style="font-size:.72rem;color:var(--text-muted)">{{ player.father_name }}</div>
          </td>
          <td style="font-family:monospace;font-size:.82rem">{{ player.national_id }}</td>
          <td style="font-size:.82rem">{{ player.phone }}</td>
          <td style="font-size:.82rem">{{ player.father_phone }}</td>
          <td>
            {% for cat in player.categories.all %}
            <span style="background:rgba(14,165,233,.1);color:var(--teal);border-radius:6px;padding:.15rem .5rem;font-size:.7rem;font-weight:600">{{ cat.name }}</span>
            {% empty %}<span style="color:var(--text-muted);font-size:.75rem">â€”</span>
            {% endfor %}
          </td>
          <td>
            {% if player.insurance_status == 'active' %}
              <span class="badge badge-green">âœ…</span>
            {% else %}
              <span class="badge badge-red">âŒ</span>
            {% endif %}
          </td>
          <td>
            <a href="{% url 'training:player-profile' player.pk %}"
               class="btn btn-outline btn-sm">ğŸ‘¤ Ù¾Ø±ÙˆÙØ§ÛŒÙ„</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- Pagination -->
{% if is_paginated %}
<div style="display:flex;justify-content:center;gap:.4rem;margin-top:1rem">
  {% if page_obj.has_previous %}
    <a href="?page={{ page_obj.previous_page_number }}{% if q %}&q={{ q }}{% endif %}" class="btn btn-outline btn-sm">â† Ù‚Ø¨Ù„ÛŒ</a>
  {% endif %}
  <span style="padding:.5rem .85rem;font-size:.82rem;color:var(--text-muted)">
    ØµÙØ­Ù‡ {{ page_obj.number }} Ø§Ø² {{ page_obj.paginator.num_pages }}
  </span>
  {% if page_obj.has_next %}
    <a href="?page={{ page_obj.next_page_number }}{% if q %}&q={{ q }}{% endif %}" class="btn btn-outline btn-sm">Ø¨Ø¹Ø¯ÛŒ â†’</a>
  {% endif %}
</div>
{% endif %}

{% else %}
<div class="card" style="text-align:center;padding:3rem">
  <div style="font-size:3rem;margin-bottom:1rem">ğŸ‘¥</div>
  <h3 style="font-weight:800;margin-bottom:.5rem">Ù‡ÛŒÚ† Ø¨Ø§Ø²ÛŒÚ©Ù†ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</h3>
  <p style="color:var(--text-muted);font-size:.875rem">
    {% if q %}Ù†ØªÛŒØ¬Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Â«{{ q }}Â» Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯{% else %}Ù‡Ù†ÙˆØ² Ø¨Ø§Ø²ÛŒÚ©Ù† ØªØ£ÛŒÛŒØ¯Ø´Ø¯Ù‡â€ŒØ§ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯{% endif %}
  </p>
</div>
{% endif %}

{% endblock %}
