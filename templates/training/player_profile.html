{% extends "base.html" %}
{% block title %}Ù¾Ø±ÙˆÙØ§ÛŒÙ„ {{ player.first_name }} {{ player.last_name }}{% endblock %}
{% block nav_my_profile %}{% if not request.user.is_technical_director %}active{% endif %}{% endblock %}
{% block nav_players %}{% if request.user.is_technical_director %}active{% endif %}{% endblock %}

{% block breadcrumb %}
  <span class="sep">â€º</span>
  {% if request.user.is_technical_director %}
    <a href="{% url 'training:player-list' %}" style="text-decoration:none;color:inherit">Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù†</a>
    <span class="sep">â€º</span>
  {% endif %}
  <span class="cur">{{ player.first_name }} {{ player.last_name }}</span>
{% endblock %}

{% block content %}
{% if not player %}
<div class="card" style="text-align:center;padding:3rem">
  <div style="font-size:3rem;margin-bottom:1rem">â“</div>
  <h3 style="font-weight:800">Ù¾Ø±ÙˆÙØ§ÛŒÙ„ ÛŒØ§ÙØª Ù†Ø´Ø¯</h3>
  <p style="color:var(--text-muted);font-size:.875rem;margin-top:.5rem">Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§Ø²ÛŒÚ©Ù† Ø¯Ø± Ø³ÛŒØ³ØªÙ… Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª</p>
</div>
{% else %}

<!-- Header -->
<div style="display:flex;align-items:flex-start;justify-content:space-between;flex-wrap:wrap;gap:.75rem;margin-bottom:1.25rem">
  <div style="display:flex;align-items:center;gap:.85rem">
    <div style="width:56px;height:56px;border-radius:50%;background:linear-gradient(135deg,var(--amber),var(--navy));display:flex;align-items:center;justify-content:center;font-size:1.4rem;color:#fff;font-weight:900">
      {{ player.first_name|slice:":1" }}{{ player.last_name|slice:":1" }}
    </div>
    <div>
      <h1 style="font-size:1.2rem;font-weight:900;color:var(--navy)">
        {{ player.first_name }} {{ player.last_name }}
      </h1>
      <div style="display:flex;align-items:center;gap:.5rem;margin-top:.2rem">
        <span style="font-size:.75rem;font-family:monospace;color:var(--text-muted)">{{ player.player_id }}</span>
        {% if player.insurance_status == 'active' %}
          <span class="badge badge-green">Ø¨ÛŒÙ…Ù‡ ÙØ¹Ø§Ù„ âœ…</span>
        {% else %}
          <span class="badge badge-red">Ø¨Ø¯ÙˆÙ† Ø¨ÛŒÙ…Ù‡</span>
        {% endif %}
      </div>
    </div>
  </div>
  {% if request.user.is_technical_director or request.user.is_superuser %}
  <a href="{% url 'registration:applicant-detail' player.pk %}" class="btn btn-navy btn-sm">âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´ Ù¾Ø±ÙˆÙØ§ÛŒÙ„</a>
  {% endif %}
</div>

<div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-bottom:1rem">

  <!-- Personal info -->
  <div class="card">
    <div class="card-header"><span class="card-title">ğŸ‘¤ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒ</span></div>
    <div style="padding:.75rem 1rem">
      {% for label, val in player_info %}
      <div style="display:flex;justify-content:space-between;padding:.45rem 0;border-bottom:1px solid var(--surface-2)">
        <span style="font-size:.8rem;color:var(--text-muted)">{{ label }}</span>
        <span style="font-size:.875rem;font-weight:600">{{ val|default:"â€”" }}</span>
      </div>
      {% empty %}
      <div style="display:flex;justify-content:space-between;padding:.45rem 0;border-bottom:1px solid var(--surface-2)">
        <span style="font-size:.8rem;color:var(--text-muted)">Ù†Ø§Ù… Ù¾Ø¯Ø±</span>
        <span style="font-size:.875rem;font-weight:600">{{ player.father_name }}</span>
      </div>
      <div style="display:flex;justify-content:space-between;padding:.45rem 0;border-bottom:1px solid var(--surface-2)">
        <span style="font-size:.8rem;color:var(--text-muted)">Ú©Ø¯ Ù…Ù„ÛŒ</span>
        <span style="font-size:.875rem;font-weight:600;font-family:monospace">{{ player.national_id }}</span>
      </div>
      <div style="display:flex;justify-content:space-between;padding:.45rem 0;border-bottom:1px solid var(--surface-2)">
        <span style="font-size:.8rem;color:var(--text-muted)">ØªØ§Ø±ÛŒØ® ØªÙˆÙ„Ø¯</span>
        <span style="font-size:.875rem;font-weight:600">{{ player.dob }}</span>
      </div>
      <div style="display:flex;justify-content:space-between;padding:.45rem 0;border-bottom:1px solid var(--surface-2)">
        <span style="font-size:.8rem;color:var(--text-muted)">Ù…ÙˆØ¨Ø§ÛŒÙ„</span>
        <span style="font-size:.875rem;font-weight:600">{{ player.phone }}</span>
      </div>
      <div style="display:flex;justify-content:space-between;padding:.45rem 0;border-bottom:1px solid var(--surface-2)">
        <span style="font-size:.8rem;color:var(--text-muted)">Ù…ÙˆØ¨Ø§ÛŒÙ„ Ù¾Ø¯Ø±</span>
        <span style="font-size:.875rem;font-weight:600">{{ player.father_phone }}</span>
      </div>
      {% if player.address %}
      <div style="display:flex;justify-content:space-between;padding:.45rem 0">
        <span style="font-size:.8rem;color:var(--text-muted)">Ø¢Ø¯Ø±Ø³</span>
        <span style="font-size:.82rem;font-weight:600;text-align:left;max-width:60%">{{ player.address }}</span>
      </div>
      {% endif %}
      {% endfor %}
    </div>
  </div>

  <!-- Biometrics + family -->
  <div class="card">
    <div class="card-header"><span class="card-title">ğŸ“ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¬Ø³Ù…Ø§Ù†ÛŒ</span></div>
    <div style="padding:.75rem 1rem">
      <div style="display:flex;justify-content:space-between;padding:.45rem 0;border-bottom:1px solid var(--surface-2)">
        <span style="font-size:.8rem;color:var(--text-muted)">Ù‚Ø¯</span>
        <span style="font-size:.875rem;font-weight:600">{% if player.height %}{{ player.height }} cm{% else %}â€”{% endif %}</span>
      </div>
      <div style="display:flex;justify-content:space-between;padding:.45rem 0;border-bottom:1px solid var(--surface-2)">
        <span style="font-size:.8rem;color:var(--text-muted)">ÙˆØ²Ù†</span>
        <span style="font-size:.875rem;font-weight:600">{% if player.weight %}{{ player.weight }} kg{% else %}â€”{% endif %}</span>
      </div>
      <div style="display:flex;justify-content:space-between;padding:.45rem 0;border-bottom:1px solid var(--surface-2)">
        <span style="font-size:.8rem;color:var(--text-muted)">Ø¯Ø³Øª Ø¨Ø±ØªØ±</span>
        <span style="font-size:.875rem;font-weight:600">{{ player.get_preferred_hand_display }}</span>
      </div>
      <div style="display:flex;justify-content:space-between;padding:.45rem 0;border-bottom:1px solid var(--surface-2)">
        <span style="font-size:.8rem;color:var(--text-muted)">Ù¾Ø§ÛŒ Ø¨Ø±ØªØ±</span>
        <span style="font-size:.875rem;font-weight:600">{{ player.get_preferred_foot_display }}</span>
      </div>
      {% if player.medical_history %}
      <div style="padding:.45rem 0;border-bottom:1px solid var(--surface-2)">
        <div style="font-size:.8rem;color:var(--text-muted);margin-bottom:.25rem">Ø³Ø§Ø¨Ù‚Ù‡ Ù¾Ø²Ø´Ú©ÛŒ</div>
        <div style="font-size:.82rem;line-height:1.5">{{ player.medical_history }}</div>
      </div>
      {% endif %}
      {% if player.injury_history %}
      <div style="padding:.45rem 0">
        <div style="font-size:.8rem;color:var(--text-muted);margin-bottom:.25rem">Ø³Ø§Ø¨Ù‚Ù‡ Ø¢Ø³ÛŒØ¨â€ŒØ¯ÛŒØ¯Ú¯ÛŒ</div>
        <div style="font-size:.82rem;line-height:1.5">{{ player.injury_history }}</div>
      </div>
      {% endif %}
    </div>
  </div>
</div>

<!-- Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§ÛŒ Ø¹Ø¶Ùˆ -->
<div class="card" style="margin-bottom:1rem">
  <div class="card-header"><span class="card-title">ğŸ—‚ï¸ Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§ÛŒ Ø¢Ù…ÙˆØ²Ø´ÛŒ</span></div>
  {% if categories %}
  <div style="padding:.75rem 1rem;display:flex;flex-wrap:wrap;gap:.5rem">
    {% for cat in categories %}
    <a href="{% url 'training:category-detail' cat.pk %}"
       style="background:rgba(14,165,233,.1);color:var(--teal);border-radius:8px;padding:.4rem 1rem;font-size:.82rem;font-weight:700;text-decoration:none;transition:background .15s"
       onmouseenter="this.style.background='rgba(14,165,233,.2)'"
       onmouseleave="this.style.background='rgba(14,165,233,.1)'">
      ğŸ—‚ï¸ {{ cat.name }}
      <span style="font-size:.7rem;opacity:.7;margin-right:.25rem">{{ cat.monthly_fee|floatformat:0 }} Ø±ÛŒØ§Ù„</span>
    </a>
    {% endfor %}
  </div>
  {% else %}
  <div style="padding:1.25rem;text-align:center;color:var(--text-muted);font-size:.875rem">Ù‡Ù†ÙˆØ² Ø¨Ù‡ Ù‡ÛŒÚ† Ø¯Ø³ØªÙ‡â€ŒØ§ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ù†Ø´Ø¯Ù‡</div>
  {% endif %}
</div>

<!-- Ø¢Ø®Ø±ÛŒÙ† ÙØ§Ú©ØªÙˆØ±Ù‡Ø§ -->
{% if recent_invoices %}
<div class="card">
  <div class="card-header">
    <span class="card-title">ğŸ§¾ Ø¢Ø®Ø±ÛŒÙ† ÙØ§Ú©ØªÙˆØ±Ù‡Ø§</span>
    <a href="{% url 'payroll:finance-dashboard' %}" class="btn btn-outline btn-sm">Ù‡Ù…Ù‡ â†</a>
  </div>
  <div class="table-wrap">
    <table class="data-table">
      <thead><tr><th>Ù…Ø§Ù‡</th><th>Ù…Ø¨Ù„Øº</th><th>ÙˆØ¶Ø¹ÛŒØª</th><th>ØªØ§Ø±ÛŒØ®</th></tr></thead>
      <tbody>
        {% for inv in recent_invoices %}
        <tr>
          <td style="font-size:.82rem">{{ inv.month|date:"Y/m" }}</td>
          <td style="font-size:.82rem">{{ inv.amount|floatformat:0 }} Ø±ÛŒØ§Ù„</td>
          <td>
            {% if inv.is_paid %}
              <span class="badge badge-green">Ù¾Ø±Ø¯Ø§Ø®Øª Ø´Ø¯Ù‡</span>
            {% else %}
              <span class="badge badge-red">Ù¾Ø±Ø¯Ø§Ø®Øª Ù†Ø´Ø¯Ù‡</span>
            {% endif %}
          </td>
          <td style="font-size:.75rem;color:var(--text-muted)">{{ inv.created_at|date:"Y/m/d" }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endif %}

{% endif %}{# end if player #}
{% endblock %}
