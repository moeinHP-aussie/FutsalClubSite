{% extends "base.html" %}
{% block title %}Ù¾Ø±ÙˆÙØ§ÛŒÙ„ {{ player.first_name }} {{ player.last_name }}{% endblock %}
{% block nav_my_profile %}{% if not request.user.is_technical_director %}active{% endif %}{% endblock %}
{% block nav_players %}{% if request.user.is_technical_director %}active{% endif %}{% endblock %}

{% block breadcrumb %}
  <span class="sep">â€º</span>
  {% if request.user.is_technical_director %}
    <a href="{% url 'training:player-list' %}" style="text-decoration:none;color:inherit">Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù†</a>
    <span class="sep">â€º</span>
  {% endif %}
  <span class="cur">{{ player.first_name }} {{ player.last_name }}</span>
{% endblock %}

{% block extra_head %}
<style>
.tab-btn {
  padding: .5rem 1.1rem; border-radius: 99px; border: 1.5px solid var(--surface-2);
  font-size: .82rem; font-weight: 700; cursor: pointer; background: none;
  font-family: inherit; transition: .12s; color: var(--text-muted);
}
.tab-btn.active { background: var(--navy); border-color: var(--navy); color: #fff; }
.tab-pane { display: none; }
.tab-pane.active { display: block; }

/* star-rating slider for traits */
.trait-row { display: flex; align-items: center; gap: .75rem; padding: .55rem 0; border-bottom: 1px solid var(--surface-2); }
.trait-row:last-child { border-bottom: none; }
.trait-name { font-size: .82rem; font-weight: 700; min-width: 130px; }
.trait-stars { display: flex; gap: .2rem; }
.star { font-size: 1.1rem; cursor: pointer; opacity: .25; transition: opacity .1s; }
.star.lit { opacity: 1; }
.trait-score-val { font-size: .75rem; font-weight: 800; color: var(--navy); min-width: 24px; text-align: center; }
input[type=range].trait-slider {
  flex: 1; accent-color: var(--amber);
  -webkit-appearance: none; height: 6px; background: var(--surface-2); border-radius: 99px; outline: none;
}
input[type=range].trait-slider::-webkit-slider-thumb {
  -webkit-appearance: none; width: 18px; height: 18px; border-radius: 50%;
  background: var(--amber); cursor: pointer; box-shadow: 0 2px 6px rgba(0,0,0,.15);
}

/* schedule table */
.sch-row { display: flex; align-items: center; gap: .6rem; padding: .5rem 0; border-bottom: 1px solid var(--surface-2); }
.sch-row:last-child { border-bottom: none; }
</style>
{% endblock %}

{% block content %}
{% if not player %}
<div class="card" style="text-align:center;padding:3rem">
  <div style="font-size:3rem;margin-bottom:1rem">â“</div>
  <h3 style="font-weight:800">Ù¾Ø±ÙˆÙØ§ÛŒÙ„ ÛŒØ§ÙØª Ù†Ø´Ø¯</h3>
</div>
{% else %}

<!-- â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div style="display:flex;align-items:flex-start;justify-content:space-between;flex-wrap:wrap;gap:.75rem;margin-bottom:1.1rem">
  <div style="display:flex;align-items:center;gap:.85rem">
    <div style="width:56px;height:56px;border-radius:50%;background:linear-gradient(135deg,var(--amber),var(--navy));display:flex;align-items:center;justify-content:center;font-size:1.4rem;color:#fff;font-weight:900">
      {{ player.first_name|slice:":1" }}{{ player.last_name|slice:":1" }}
    </div>
    <div>
      <h1 style="font-size:1.2rem;font-weight:900;color:var(--navy)">
        {{ player.first_name }} {{ player.last_name }}
        {% if tech_profile.shirt_number %}
          <span style="font-size:.8rem;background:var(--navy);color:#fff;border-radius:6px;padding:.1rem .5rem;margin-right:.4rem">
            #{{ tech_profile.shirt_number }}
          </span>
        {% endif %}
      </h1>
      <div style="display:flex;align-items:center;gap:.5rem;margin-top:.2rem;flex-wrap:wrap">
        <span style="font-size:.72rem;font-family:monospace;color:var(--text-muted)">{{ player.player_id }}</span>
        <span class="badge {% if player.insurance_status == 'active' %}badge-green{% else %}badge-red{% endif %}">
          {{ player.get_insurance_status_display }}
        </span>
        {% if tech_profile.position and tech_profile.position != '-' %}
        <span class="badge" style="background:rgba(124,58,237,.12);color:#4c1d95">
          {{ tech_profile.get_position_display }}
        </span>
        {% endif %}
        {% if tech_profile.skill_level %}
        <span class="badge" style="background:#fef3c7;color:#92400e">Ø³Ø·Ø­ {{ tech_profile.skill_level }}</span>
        {% endif %}
        {% if tech_profile.is_two_footed %}
        <span class="badge badge-teal">Ø¯ÙˆÙ¾Ø§ ğŸ¦¶</span>
        {% endif %}
      </div>
    </div>
  </div>
  <div style="display:flex;gap:.5rem;flex-wrap:wrap">
    {% if can_edit_tech %}
    <a href="{% url 'registration:player-edit' player.pk %}" class="btn btn-navy btn-sm">âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª</a>
    {% endif %}
  </div>
</div>

<!-- â”€â”€ Tabs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div style="display:flex;gap:.4rem;flex-wrap:wrap;margin-bottom:1rem">
  <button class="tab-btn active" onclick="showTab('info',this)">ğŸ“‹ Ø§Ø·Ù„Ø§Ø¹Ø§Øª</button>
  {% if can_edit_tech or request.user.is_technical_director %}
  <button class="tab-btn" onclick="showTab('tech',this)">âš½ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ ÙÙ†ÛŒ</button>
  <button class="tab-btn" onclick="showTab('traits',this)">ğŸ§  ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù†Ø±Ù…</button>
  {% endif %}
  <button class="tab-btn" onclick="showTab('insurance',this)">ğŸ›¡ï¸ Ø¨ÛŒÙ…Ù‡</button>
  <button class="tab-btn" onclick="showTab('invoices',this)">ğŸ§¾ ÙØ§Ú©ØªÙˆØ±Ù‡Ø§</button>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TAB: Ø§Ø·Ù„Ø§Ø¹Ø§Øª
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-pane active" id="tab-info">
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem">

    <!-- Ø´Ø®ØµÛŒ -->
    <div class="card">
      <div class="card-header"><span class="card-title">ğŸ‘¤ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒ</span></div>
      <div style="padding:.75rem 1rem">
        {% for label, val in info_rows %}
        <div style="display:flex;justify-content:space-between;padding:.45rem 0;border-bottom:1px solid var(--surface-2)">
          <span style="font-size:.8rem;color:var(--text-muted)">{{ label }}</span>
          <span style="font-size:.875rem;font-weight:600">{{ val|default:"â€”" }}</span>
        </div>
        {% empty %}
        <div style="display:flex;justify-content:space-between;padding:.45rem 0;border-bottom:1px solid var(--surface-2)">
          <span style="font-size:.8rem;color:var(--text-muted)">Ù†Ø§Ù… Ù¾Ø¯Ø±</span><span style="font-size:.875rem;font-weight:600">{{ player.father_name|default:"â€”" }}</span>
        </div>
        <div style="display:flex;justify-content:space-between;padding:.45rem 0;border-bottom:1px solid var(--surface-2)">
          <span style="font-size:.8rem;color:var(--text-muted)">Ú©Ø¯ Ù…Ù„ÛŒ</span><span style="font-size:.875rem;font-weight:600;font-family:monospace">{{ player.national_id }}</span>
        </div>
        <div style="display:flex;justify-content:space-between;padding:.45rem 0;border-bottom:1px solid var(--surface-2)">
          <span style="font-size:.8rem;color:var(--text-muted)">ØªØ§Ø±ÛŒØ® ØªÙˆÙ„Ø¯</span><span style="font-size:.875rem;font-weight:600">{{ player.dob|default:"â€”" }}</span>
        </div>
        <div style="display:flex;justify-content:space-between;padding:.45rem 0;border-bottom:1px solid var(--surface-2)">
          <span style="font-size:.8rem;color:var(--text-muted)">Ø±Ø¯Ù‡ Ø³Ù†ÛŒ</span><span style="font-size:.875rem;font-weight:600">{{ player.get_age_category }}</span>
        </div>
        <div style="display:flex;justify-content:space-between;padding:.45rem 0;border-bottom:1px solid var(--surface-2)">
          <span style="font-size:.8rem;color:var(--text-muted)">Ù…ÙˆØ¨Ø§ÛŒÙ„</span><span style="font-size:.875rem;font-weight:600">{{ player.phone|default:"â€”" }}</span>
        </div>
        <div style="display:flex;justify-content:space-between;padding:.45rem 0;border-bottom:1px solid var(--surface-2)">
          <span style="font-size:.8rem;color:var(--text-muted)">Ù…ÙˆØ¨Ø§ÛŒÙ„ Ù¾Ø¯Ø±</span><span style="font-size:.875rem;font-weight:600">{{ player.father_phone|default:"â€”" }}</span>
        </div>
        <div style="display:flex;justify-content:space-between;padding:.45rem 0;border-bottom:1px solid var(--surface-2)">
          <span style="font-size:.8rem;color:var(--text-muted)">Ù…ÙˆØ¨Ø§ÛŒÙ„ Ù…Ø§Ø¯Ø±</span><span style="font-size:.875rem;font-weight:600">{{ player.mother_phone|default:"â€”" }}</span>
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- Ø¬Ø³Ù…Ø§Ù†ÛŒ -->
    <div class="card">
      <div class="card-header"><span class="card-title">ğŸ“ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¬Ø³Ù…Ø§Ù†ÛŒ</span></div>
      <div style="padding:.75rem 1rem">
        {% for label, val in biometric_rows %}
        <div style="display:flex;justify-content:space-between;padding:.45rem 0;border-bottom:1px solid var(--surface-2)">
          <span style="font-size:.8rem;color:var(--text-muted)">{{ label }}</span>
          <span style="font-size:.875rem;font-weight:600">{{ val|default:"â€”" }}</span>
        </div>
        {% empty %}
        <div style="display:flex;justify-content:space-between;padding:.45rem 0;border-bottom:1px solid var(--surface-2)">
          <span style="font-size:.8rem;color:var(--text-muted)">Ù‚Ø¯</span><span style="font-size:.875rem;font-weight:600">{% if player.height %}{{ player.height }} cm{% else %}â€”{% endif %}</span>
        </div>
        <div style="display:flex;justify-content:space-between;padding:.45rem 0;border-bottom:1px solid var(--surface-2)">
          <span style="font-size:.8rem;color:var(--text-muted)">ÙˆØ²Ù†</span><span style="font-size:.875rem;font-weight:600">{% if player.weight %}{{ player.weight }} kg{% else %}â€”{% endif %}</span>
        </div>
        <div style="display:flex;justify-content:space-between;padding:.45rem 0;border-bottom:1px solid var(--surface-2)">
          <span style="font-size:.8rem;color:var(--text-muted)">Ø¯Ø³Øª Ø¨Ø±ØªØ±</span><span style="font-size:.875rem;font-weight:600">{{ player.get_preferred_hand_display }}</span>
        </div>
        <div style="display:flex;justify-content:space-between;padding:.45rem 0">
          <span style="font-size:.8rem;color:var(--text-muted)">Ù¾Ø§ÛŒ Ø¨Ø±ØªØ±</span><span style="font-size:.875rem;font-weight:600">{{ player.get_preferred_foot_display }}</span>
        </div>
        {% endfor %}
        {% if player.medical_history %}
        <div style="padding:.5rem 0;border-top:1px solid var(--surface-2);margin-top:.3rem">
          <div style="font-size:.78rem;color:var(--text-muted);margin-bottom:.25rem">Ø³Ø§Ø¨Ù‚Ù‡ Ù¾Ø²Ø´Ú©ÛŒ</div>
          <div style="font-size:.8rem;line-height:1.6">{{ player.medical_history }}</div>
        </div>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§ -->
  <div class="card" style="margin-top:1rem">
    <div class="card-header"><span class="card-title">ğŸ—‚ï¸ Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§ÛŒ Ø¢Ù…ÙˆØ²Ø´ÛŒ</span></div>
    {% if categories %}
    <div style="padding:.75rem 1rem;display:flex;flex-wrap:wrap;gap:.5rem">
      {% for cat in categories %}
      <a href="{% url 'training:category-detail' cat.pk %}"
         style="background:rgba(14,165,233,.1);color:var(--teal);border-radius:8px;padding:.4rem 1rem;font-size:.82rem;font-weight:700;text-decoration:none">
        ğŸ—‚ï¸ {{ cat.name }}
      </a>
      {% endfor %}
    </div>
    {% else %}
    <div style="padding:1.25rem;text-align:center;color:var(--text-muted);font-size:.875rem">Ù‡Ù†ÙˆØ² Ø¨Ù‡ Ù‡ÛŒÚ† Ø¯Ø³ØªÙ‡â€ŒØ§ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ù†Ø´Ø¯Ù‡</div>
    {% endif %}
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TAB: Ù¾Ø±ÙˆÙØ§ÛŒÙ„ ÙÙ†ÛŒ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
{% if can_edit_tech or request.user.is_technical_director %}
<div class="tab-pane" id="tab-tech">
  <div class="card">
    <div class="card-header">
      <span class="card-title">âš½ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ ÙÙ†ÛŒ</span>
      {% if tech_profile.updated_at %}
      <span style="font-size:.72rem;color:var(--text-muted)">Ø¢Ø®Ø±ÛŒÙ† ÙˆÛŒØ±Ø§ÛŒØ´: {{ tech_profile.updated_at|date:"Y/m/d" }}</span>
      {% endif %}
    </div>
    <div style="padding:1rem 1.25rem">
      <form method="post" action="{% url 'training:tech-profile-update' player.pk %}">
        {% csrf_token %}
        <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:1rem;margin-bottom:1rem">
          <div>
            <label style="font-size:.82rem;font-weight:700;display:block;margin-bottom:.3rem">Ø´Ù…Ø§Ø±Ù‡ Ù¾ÛŒØ±Ø§Ù‡Ù†</label>
            <input type="number" name="shirt_number" min="1" max="99"
                   value="{{ tech_profile.shirt_number|default:'' }}"
                   placeholder="Ù…Ø«Ø§Ù„: 10"
                   style="width:100%;padding:.55rem .75rem;border:1.5px solid var(--surface-2);border-radius:8px;font-family:inherit;font-size:.875rem">
          </div>
          <div>
            <label style="font-size:.82rem;font-weight:700;display:block;margin-bottom:.3rem">Ù¾Ø³Øª</label>
            <select name="position"
                    style="width:100%;padding:.55rem .75rem;border:1.5px solid var(--surface-2);border-radius:8px;font-family:inherit;font-size:.875rem">
              <option value="-" {% if tech_profile.position == '-' %}selected{% endif %}>Ù…Ø´Ø®Øµ Ù†Ø´Ø¯Ù‡</option>
              <option value="gk" {% if tech_profile.position == 'gk' %}selected{% endif %}>ğŸ¥… Ø¯Ø±ÙˆØ§Ø²Ù‡â€ŒØ¨Ø§Ù†</option>
              <option value="fixo" {% if tech_profile.position == 'fixo' %}selected{% endif %}>ğŸ›¡ï¸ ÙÛŒÚ©Ø³Ùˆ</option>
              <option value="winger" {% if tech_profile.position == 'winger' %}selected{% endif %}>ğŸ’¨ ÙˆÛŒÙ†Ú¯Ø± / Ø¨Ø§Ù„</option>
              <option value="pivot" {% if tech_profile.position == 'pivot' %}selected{% endif %}>âš¡ Ù¾ÛŒÙˆØª</option>
            </select>
          </div>
          <div>
            <label style="font-size:.82rem;font-weight:700;display:block;margin-bottom:.3rem">Ø³Ø·Ø­ Ù…Ù‡Ø§Ø±Øª</label>
            <select name="skill_level"
                    style="width:100%;padding:.55rem .75rem;border:1.5px solid var(--surface-2);border-radius:8px;font-family:inherit;font-size:.875rem">
              <option value="" {% if not tech_profile.skill_level %}selected{% endif %}>Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</option>
              {% for lv in "ABCDEF" %}
              <option value="{{ lv }}" {% if tech_profile.skill_level == lv %}selected{% endif %}>{{ lv }}</option>
              {% endfor %}
            </select>
          </div>
        </div>
        <div style="margin-bottom:1rem">
          <label style="display:flex;align-items:center;gap:.6rem;cursor:pointer">
            <input type="checkbox" name="is_two_footed" {% if tech_profile.is_two_footed %}checked{% endif %}
                   style="accent-color:var(--navy);width:16px;height:16px">
            <span style="font-size:.875rem;font-weight:700">Ø¯ÙˆÙ¾Ø§ ğŸ¦¶</span>
          </label>
        </div>
        <div style="margin-bottom:1.25rem">
          <label style="font-size:.82rem;font-weight:700;display:block;margin-bottom:.3rem">ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ù…Ø±Ø¨ÛŒ (Ù…Ø­Ø±Ù…Ø§Ù†Ù‡)</label>
          <textarea name="coach_notes" rows="3" placeholder="Ù†Ú©Ø§Øª ÙÙ†ÛŒØŒ Ù…Ø´Ø§Ù‡Ø¯Ø§Øª ØªÙ…Ø±ÛŒÙ†..."
                    style="width:100%;padding:.6rem .85rem;border:1.5px solid var(--surface-2);border-radius:8px;font-family:inherit;font-size:.85rem;resize:vertical">{{ tech_profile.coach_notes }}</textarea>
        </div>
        <div style="display:flex;justify-content:flex-end">
          <button type="submit" class="btn btn-navy">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ ÙÙ†ÛŒ</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TAB: ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù†Ø±Ù…
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-pane" id="tab-traits">
  <div class="card">
    <div class="card-header">
      <span class="card-title">ğŸ§  ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù†Ø±Ù…</span>
      <a href="{% url 'training:soft-trait-types' %}" class="btn btn-outline btn-sm">âš™ï¸ Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ù†ÙˆØ§Ø¹</a>
    </div>
    <div style="padding:1rem 1.25rem">
      {% if soft_traits %}
      <form method="post" action="{% url 'training:soft-traits-update' player.pk %}">
        {% csrf_token %}
        {% for item in soft_traits %}
        <div class="trait-row">
          <span class="trait-name">{{ item.type.name }}</span>
          <input type="range" class="trait-slider" min="0" max="10" step="1"
                 name="trait_{{ item.type.pk }}"
                 value="{{ item.score }}"
                 id="slider-{{ item.type.pk }}"
                 oninput="updSlider({{ item.type.pk }}, this.value)">
          <span class="trait-score-val" id="sv-{{ item.type.pk }}">
            {{ item.score|default:"0" }}
          </span>
          <!-- stars display -->
          <div class="trait-stars" id="stars-{{ item.type.pk }}">
            {% for i in "12345678910"|make_list %}
            <span class="star {% if item.score >= forloop.counter %}lit{% endif %}"
                  onclick="setSlider({{ item.type.pk }}, {{ forloop.counter }})">â˜…</span>
            {% endfor %}
          </div>
        </div>
        {% endfor %}
        <div style="display:flex;justify-content:flex-end;margin-top:1rem">
          <button type="submit" class="btn btn-navy">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§</button>
        </div>
      </form>
      {% else %}
      <div style="text-align:center;padding:2rem;color:var(--text-muted)">
        <div style="font-size:2rem;margin-bottom:.75rem">ğŸ§ </div>
        <p style="font-size:.875rem">Ù‡Ù†ÙˆØ² Ù†ÙˆØ¹ ÙˆÛŒÚ˜Ú¯ÛŒ Ù†Ø±Ù…ÛŒ ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡.</p>
        <a href="{% url 'training:soft-trait-types' %}" class="btn btn-navy" style="margin-top:.75rem">
          â• ØªØ¹Ø±ÛŒÙ ÙˆÛŒÚ˜Ú¯ÛŒ Ø¬Ø¯ÛŒØ¯
        </a>
      </div>
      {% endif %}
    </div>
  </div>
</div>
{% endif %}

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TAB: Ø¨ÛŒÙ…Ù‡
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-pane" id="tab-insurance">
  <div class="card">
    <div class="card-header">
      <span class="card-title">ğŸ›¡ï¸ Ø¨ÛŒÙ…Ù‡â€ŒÙ†Ø§Ù…Ù‡</span>
      {% if player.insurance_status == 'active' %}
        <span class="badge badge-green">âœ… ÙØ¹Ø§Ù„ â€” Ø§Ù†Ù‚Ø¶Ø§: {{ player.insurance_expiry_date|default:"â€”" }}</span>
      {% else %}
        <span class="badge badge-red">âŒ Ø¨Ø¯ÙˆÙ† Ø¨ÛŒÙ…Ù‡</span>
      {% endif %}
    </div>
    <div style="padding:.85rem 1.25rem">
      {% if player.insurance_image %}
      <div style="margin-bottom:1rem">
        <a href="{{ player.insurance_image.url }}" target="_blank">
          <img src="{{ player.insurance_image.url }}" alt="Ø¨ÛŒÙ…Ù‡â€ŒÙ†Ø§Ù…Ù‡"
               style="max-width:100%;max-height:240px;object-fit:contain;border-radius:8px;border:1px solid var(--surface-2)">
        </a>
      </div>
      {% endif %}
      {% if request.user.is_technical_director or request.user.is_coach or request.user.player_profile == player %}
      <form method="post" action="{% url 'registration:insurance-upload' player.pk %}" enctype="multipart/form-data"
            style="display:flex;gap:.6rem;align-items:center;flex-wrap:wrap">
        {% csrf_token %}
        <input type="file" name="insurance_image" accept="image/*"
               style="font-size:.82rem;flex:1;min-width:180px">
        <button type="submit" class="btn btn-teal btn-sm">ğŸ“¤ Ø¢Ù¾Ù„ÙˆØ¯ ØªØµÙˆÛŒØ± Ø¨ÛŒÙ…Ù‡</button>
      </form>
      {% endif %}
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TAB: ÙØ§Ú©ØªÙˆØ±Ù‡Ø§
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-pane" id="tab-invoices">
  {% if recent_invoices %}
  <div class="card">
    <div class="card-header"><span class="card-title">ğŸ§¾ Ø¢Ø®Ø±ÛŒÙ† ÙØ§Ú©ØªÙˆØ±Ù‡Ø§</span></div>
    <div class="table-wrap">
      <table class="data-table">
        <thead><tr><th>Ù…Ø§Ù‡</th><th>Ù…Ø¨Ù„Øº</th><th>ÙˆØ¶Ø¹ÛŒØª</th></tr></thead>
        <tbody>
          {% for inv in recent_invoices %}
          <tr>
            <td style="font-size:.82rem">{{ inv.jalali_year }}/{{ inv.jalali_month|stringformat:"02d" }}</td>
            <td style="font-size:.82rem">{{ inv.amount|floatformat:0 }} Ø±ÛŒØ§Ù„</td>
            <td>
              <span class="badge {% if inv.status == 'paid' %}badge-green{% else %}badge-red{% endif %}">
                {{ inv.get_status_display }}
              </span>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  {% else %}
  <div class="card" style="text-align:center;padding:2rem">
    <div style="font-size:2rem;margin-bottom:.5rem">ğŸ§¾</div>
    <p style="color:var(--text-muted);font-size:.875rem">Ù‡Ù†ÙˆØ² ÙØ§Ú©ØªÙˆØ±ÛŒ ØµØ§Ø¯Ø± Ù†Ø´Ø¯Ù‡</p>
  </div>
  {% endif %}
</div>

{% endif %}{# end if player #}

<script>
function showTab(name, btn) {
  document.querySelectorAll(".tab-pane").forEach(p => p.classList.remove("active"));
  document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
  document.getElementById("tab-" + name)?.classList.add("active");
  btn.classList.add("active");
}

function updSlider(id, val) {
  document.getElementById("sv-" + id).textContent = val;
  const stars = document.getElementById("stars-" + id)?.querySelectorAll(".star");
  stars?.forEach((s, i) => s.classList.toggle("lit", i < parseInt(val)));
}

function setSlider(id, val) {
  const sl = document.getElementById("slider-" + id);
  if (sl) { sl.value = val; updSlider(id, val); }
}
</script>
{% endblock %}