{% extends "base.html" %}
{% block title %}{{ category.name }}<script>
function toggleForm(id) {
  const el = document.getElementById(id);
  el.style.display = el.style.display === 'none' ? 'block' : 'none';
}
</script>
{% endblock %}
{% block nav_categories %}active{% endblock %}

{% block breadcrumb %}
  <span class="sep">â€º</span>
  <a href="{% url 'training:category-list' %}" style="text-decoration:none;color:inherit">Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§</a>
  <span class="sep">â€º</span><span class="cur">{{ category.name }}</span>
{% endblock %}

{% block content %}

<!-- Header -->
<div style="display:flex;align-items:flex-start;justify-content:space-between;flex-wrap:wrap;gap:.75rem;margin-bottom:1.25rem">
  <div>
    <div style="display:flex;align-items:center;gap:.75rem">
      <h1 style="font-size:1.3rem;font-weight:900;color:var(--navy)">{{ category.name }}</h1>
      {% if category.is_active %}
        <span class="badge badge-green">ÙØ¹Ø§Ù„</span>
      {% else %}
        <span class="badge" style="background:#f1f5f9;color:#64748b">ØºÛŒØ±ÙØ¹Ø§Ù„</span>
      {% endif %}
    </div>
    {% if category.description %}
    <p style="font-size:.85rem;color:var(--text-muted);margin-top:.3rem">{{ category.description }}</p>
    {% endif %}
  </div>
  {% if request.user.is_technical_director or request.user.is_superuser %}
  <div style="display:flex;gap:.5rem">
    <a href="{% url 'training:category-update' category.pk %}" class="btn btn-navy btn-sm">âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´</a>
    <a href="{% url 'training:attendance-select' %}?cat={{ category.pk }}" class="btn btn-amber btn-sm">ğŸ“… Ø«Ø¨Øª Ø­Ø¶ÙˆØ±</a>
  </div>
  {% endif %}
</div>

<!-- Stats row -->
<div class="grid-auto" style="margin-bottom:1.25rem">
  <div class="stat-card amber">
    <div class="stat-label">Ø´Ù‡Ø±ÛŒÙ‡ Ù…Ø§Ù‡Ø§Ù†Ù‡</div>
    <div class="stat-value" style="font-size:1.4rem">{{ category.monthly_fee|floatformat:0 }}</div>
    <div class="stat-sub">Ø±ÛŒØ§Ù„</div>
    <span class="stat-icon">ğŸ’°</span>
  </div>
  <div class="stat-card navy">
    <div class="stat-label">ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù†</div>
    <div class="stat-value">{{ players|length }}</div>
    <span class="stat-icon">ğŸ‘¥</span>
  </div>
  <div class="stat-card teal">
    <div class="stat-label">Ù…Ø±Ø¨ÛŒØ§Ù†</div>
    <div class="stat-value">{{ coach_rates|length }}</div>
    <span class="stat-icon">ğŸƒ</span>
  </div>
  <div class="stat-card green">
    <div class="stat-label">Ø¬Ù„Ø³Ø§Øª Ø¯Ø± Ù‡ÙØªÙ‡</div>
    <div class="stat-value">{{ schedules|length }}</div>
    <span class="stat-icon">ğŸ“…</span>
  </div>
</div>

<div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-bottom:1rem">

  <!-- Schedule -->
  <div class="card">
    <div class="card-header">
      <span class="card-title">ğŸ“… Ø¨Ø±Ù†Ø§Ù…Ù‡ ØªÙ…Ø±ÛŒÙ†</span>
      {% if request.user.is_technical_director or request.user.is_superuser %}
      <button class="btn btn-amber btn-sm" onclick="toggleForm('sch-add-form')">+ Ø§ÙØ²ÙˆØ¯Ù† Ø¬Ù„Ø³Ù‡</button>
      {% endif %}
    </div>

    <!-- ÙØ±Ù… Ø§ÙØ²ÙˆØ¯Ù† Ø¬Ù„Ø³Ù‡ -->
    {% if request.user.is_technical_director or request.user.is_superuser %}
    <div id="sch-add-form" style="display:none;padding:.85rem 1rem;border-bottom:1px solid var(--surface-2);background:#f8fafc">
      <form method="post" action="{% url 'training:schedule-add' category.pk %}"
            style="display:flex;gap:.6rem;flex-wrap:wrap;align-items:flex-end">
        {% csrf_token %}
        <div>
          <label style="font-size:.75rem;font-weight:700;display:block;margin-bottom:.2rem">Ø±ÙˆØ² Ù‡ÙØªÙ‡ *</label>
          <select name="weekday"
                  style="padding:.5rem .65rem;border:1.5px solid var(--surface-2);border-radius:8px;font-family:inherit;font-size:.82rem">
            <option value="sat">Ø´Ù†Ø¨Ù‡</option>
            <option value="sun">ÛŒÚ©Ø´Ù†Ø¨Ù‡</option>
            <option value="mon">Ø¯ÙˆØ´Ù†Ø¨Ù‡</option>
            <option value="tue">Ø³Ù‡â€ŒØ´Ù†Ø¨Ù‡</option>
            <option value="wed">Ú†Ù‡Ø§Ø±Ø´Ù†Ø¨Ù‡</option>
            <option value="thu">Ù¾Ù†Ø¬Ø´Ù†Ø¨Ù‡</option>
            <option value="fri">Ø¬Ù…Ø¹Ù‡</option>
          </select>
        </div>
        <div>
          <label style="font-size:.75rem;font-weight:700;display:block;margin-bottom:.2rem">Ø³Ø§Ø¹Øª Ø´Ø±ÙˆØ¹ *</label>
          <input type="time" name="start_time" required
                 style="padding:.5rem .65rem;border:1.5px solid var(--surface-2);border-radius:8px;font-family:inherit;font-size:.82rem">
        </div>
        <div>
          <label style="font-size:.75rem;font-weight:700;display:block;margin-bottom:.2rem">Ø³Ø§Ø¹Øª Ù¾Ø§ÛŒØ§Ù†</label>
          <input type="time" name="end_time"
                 style="padding:.5rem .65rem;border:1.5px solid var(--surface-2);border-radius:8px;font-family:inherit;font-size:.82rem">
        </div>
        <div>
          <label style="font-size:.75rem;font-weight:700;display:block;margin-bottom:.2rem">Ù…Ú©Ø§Ù† / Ø³Ø§Ù„Ù†</label>
          <input type="text" name="location" placeholder="Ù…Ø«Ø§Ù„: Ø³Ø§Ù„Ù† Ø§ØµÙ„ÛŒ"
                 style="padding:.5rem .65rem;border:1.5px solid var(--surface-2);border-radius:8px;font-family:inherit;font-size:.82rem;width:140px">
        </div>
        <button type="submit" class="btn btn-navy btn-sm">âœ… Ø°Ø®ÛŒØ±Ù‡</button>
      </form>
    </div>
    {% endif %}

    {% if schedules %}
    <div style="padding:.6rem .85rem">
      {% for sch in schedules %}
      <div class="sch-row" style="display:flex;align-items:center;gap:.6rem;padding:.5rem 0;border-bottom:1px solid var(--surface-2)">
        <span style="font-size:1rem">ğŸ“…</span>
        <div style="flex:1">
          <strong style="font-size:.875rem">{{ sch.get_weekday_display }}</strong>
          {% if sch.location %}
          <span style="font-size:.75rem;color:var(--text-muted);margin-right:.35rem">Â· {{ sch.location }}</span>
          {% endif %}
        </div>
        <span style="font-size:.82rem;color:var(--teal);font-weight:700">
          {{ sch.start_time|time:"H:i" }}
          {% if sch.end_time %}<span style="color:var(--text-muted)"> â€” </span>{{ sch.end_time|time:"H:i" }}{% endif %}
        </span>
        {% if request.user.is_technical_director or request.user.is_superuser %}
        <form method="post" action="{% url 'training:schedule-delete' sch.pk %}"
              onsubmit="return confirm('Ø§ÛŒÙ† Ø¬Ù„Ø³Ù‡ Ø­Ø°Ù Ø´ÙˆØ¯ØŸ')"
              style="margin:0">
          {% csrf_token %}
          <button type="submit"
                  style="background:none;border:none;cursor:pointer;font-size:.85rem;color:#ef4444;padding:.2rem .4rem">
            âœ•
          </button>
        </form>
        {% endif %}
      </div>
      {% endfor %}
    </div>
    {% else %}
    <div style="padding:1.5rem;text-align:center;color:var(--text-muted);font-size:.875rem">
      Ù‡Ù†ÙˆØ² Ø¬Ù„Ø³Ù‡â€ŒØ§ÛŒ ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡ â€” Ø±ÙˆÛŒ Â«+ Ø§ÙØ²ÙˆØ¯Ù† Ø¬Ù„Ø³Ù‡Â» Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯.
    </div>
    {% endif %}
  </div>

  <!-- Coaches -->
  <div class="card">
    <div class="card-header">
      <span class="card-title">ğŸƒ Ù…Ø±Ø¨ÛŒØ§Ù†</span>
    </div>
    {% if coach_rates %}
    <div style="padding:.75rem 1rem">
      {% for cr in coach_rates %}
      <div style="display:flex;align-items:center;justify-content:space-between;padding:.6rem 0;border-bottom:1px solid var(--surface-2)">
        <div>
          <div style="font-weight:700;font-size:.875rem">{{ cr.coach.first_name }} {{ cr.coach.last_name }}</div>
          <div style="font-size:.72rem;color:var(--text-muted)">{{ cr.coach.get_degree_display }}</div>
        </div>
        <span style="font-size:.78rem;color:var(--amber);font-weight:700">
          {{ cr.session_rate|floatformat:0 }} Ø±ÛŒØ§Ù„/Ø¬Ù„Ø³Ù‡
        </span>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <div style="padding:1.5rem;text-align:center;color:var(--text-muted);font-size:.875rem">
      Ù‡Ù†ÙˆØ² Ù…Ø±Ø¨ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ù†Ø´Ø¯Ù‡
    </div>
    {% endif %}
  </div>
</div>

<!-- Players table -->
<div class="card">
  <div class="card-header">
    <span class="card-title">ğŸ‘¥ Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† ({{ players|length }})</span>
    {% if request.user.is_technical_director or request.user.is_superuser %}
    <a href="{% url 'training:attendance-select' %}?cat={{ category.pk }}" class="btn btn-amber btn-sm">ğŸ“… Ø«Ø¨Øª Ø­Ø¶ÙˆØ±</a>
    {% endif %}
  </div>
  {% if players %}
  <div class="table-wrap">
    <table class="data-table">
      <thead>
        <tr>
          <th>#</th>
          <th>Ù†Ø§Ù…</th>
          <th>Ú©Ø¯ Ù…Ù„ÛŒ</th>
          <th>Ù…ÙˆØ¨Ø§ÛŒÙ„</th>
          <th>Ø¨ÛŒÙ…Ù‡</th>
          <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
        </tr>
      </thead>
      <tbody>
        {% for player in players %}
        <tr>
          <td style="color:var(--text-muted);font-size:.8rem">{{ forloop.counter }}</td>
          <td><strong>{{ player.first_name }} {{ player.last_name }}</strong></td>
          <td style="font-family:monospace;font-size:.82rem">{{ player.national_id }}</td>
          <td style="font-size:.82rem">{{ player.phone }}</td>
          <td>
            {% if player.insurance_status == 'active' %}
              <span class="badge badge-green">âœ… Ø¯Ø§Ø±Ø¯</span>
            {% else %}
              <span class="badge badge-red">âŒ Ù†Ø¯Ø§Ø±Ø¯</span>
            {% endif %}
          </td>
          <td>
            <a href="{% url 'training:player-profile' player.pk %}"
               class="btn btn-outline btn-sm">ğŸ‘¤ Ù¾Ø±ÙˆÙØ§ÛŒÙ„</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <div style="padding:2rem;text-align:center;color:var(--text-muted)">
    Ù‡Ù†ÙˆØ² Ø¨Ø§Ø²ÛŒÚ©Ù†ÛŒ Ø¨Ù‡ Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡ Ø§Ø¶Ø§ÙÙ‡ Ù†Ø´Ø¯Ù‡
  </div>
  {% endif %}
</div>

{% endblock %}