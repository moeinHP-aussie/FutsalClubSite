{% extends "base.html" %}
{% block title %}Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§ÛŒ Ø¢Ù…ÙˆØ²Ø´ÛŒ{% endblock %}
{% block nav_categories %}active{% endblock %}

{% block breadcrumb %}
  <span class="sep">â€º</span><span class="cur">Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§ÛŒ Ø¢Ù…ÙˆØ²Ø´ÛŒ</span>
{% endblock %}

{% block content %}

<!-- Header bar -->
<div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:.75rem;margin-bottom:1.25rem">
  <div>
    <h1 style="font-size:1.25rem;font-weight:900;color:var(--navy)">ğŸ—‚ï¸ Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§ÛŒ Ø¢Ù…ÙˆØ²Ø´ÛŒ</h1>
    <p style="font-size:.82rem;color:var(--text-muted);margin-top:.2rem">
      {{ total_active }} Ø¯Ø³ØªÙ‡ ÙØ¹Ø§Ù„ &nbsp;Â·&nbsp; {{ total_inactive }} ØºÛŒØ±ÙØ¹Ø§Ù„
    </p>
  </div>
  {% if request.user.is_technical_director or request.user.is_superuser %}
  <a href="{% url 'training:category-create' %}" class="btn btn-amber">
    â• Ø¯Ø³ØªÙ‡ Ø¬Ø¯ÛŒØ¯
  </a>
  {% endif %}
</div>

<!-- Filter bar -->
<div class="card" style="padding:.85rem 1rem;margin-bottom:1rem">
  <form method="get" style="display:flex;gap:.6rem;flex-wrap:wrap;align-items:center">
    <input type="text" name="q" value="{{ q }}"
           placeholder="Ø¬Ø³ØªØ¬ÙˆÛŒ Ù†Ø§Ù… Ø¯Ø³ØªÙ‡..."
           style="padding:.55rem .85rem;border:1.5px solid var(--surface-2);border-radius:8px;font-family:inherit;font-size:.875rem;min-width:200px">
    <div style="display:flex;gap:.4rem">
      <a href="?show=active{% if q %}&q={{ q }}{% endif %}"
         class="btn {% if show == 'active' %}btn-navy{% else %}btn-outline{% endif %} btn-sm">ÙØ¹Ø§Ù„</a>
      <a href="?show=inactive{% if q %}&q={{ q }}{% endif %}"
         class="btn {% if show == 'inactive' %}btn-navy{% else %}btn-outline{% endif %} btn-sm">ØºÛŒØ±ÙØ¹Ø§Ù„</a>
      <a href="?show=all{% if q %}&q={{ q }}{% endif %}"
         class="btn {% if show == 'all' %}btn-navy{% else %}btn-outline{% endif %} btn-sm">Ù‡Ù…Ù‡</a>
    </div>
    <button type="submit" class="btn btn-primary btn-sm">ğŸ” Ø¬Ø³ØªØ¬Ùˆ</button>
    {% if q %}<a href="?" class="btn btn-outline btn-sm">âœ• Ù¾Ø§Ú©</a>{% endif %}
  </form>
</div>

<!-- Category cards grid -->
{% if categories %}
<div class="grid-auto">
  {% for cat in categories %}
  <div class="card" style="padding:0;overflow:hidden;transition:transform .2s,box-shadow .2s"
       onmouseenter="this.style.transform='translateY(-3px)';this.style.boxShadow='0 8px 28px rgba(13,27,42,.14)'"
       onmouseleave="this.style.transform='';this.style.boxShadow=''">

    <!-- Color top bar -->
    <div style="height:4px;background:{% if cat.is_active %}linear-gradient(90deg,var(--amber),var(--amber-light)){% else %}var(--surface-2){% endif %}"></div>

    <div style="padding:1.1rem 1.25rem">
      <!-- Name + status -->
      <div style="display:flex;align-items:flex-start;justify-content:space-between;gap:.5rem;margin-bottom:.75rem">
        <div>
          <div style="font-weight:800;font-size:1rem;color:var(--navy)">{{ cat.name }}</div>
          {% if cat.description %}
          <div style="font-size:.75rem;color:var(--text-muted);margin-top:.2rem;line-height:1.4">{{ cat.description|truncatechars:60 }}</div>
          {% endif %}
        </div>
        {% if cat.is_active %}
          <span class="badge badge-green">ÙØ¹Ø§Ù„</span>
        {% else %}
          <span class="badge" style="background:#f1f5f9;color:#64748b">ØºÛŒØ±ÙØ¹Ø§Ù„</span>
        {% endif %}
      </div>

      <!-- Stats row -->
      <div style="display:flex;gap:1rem;margin-bottom:.9rem">
        <div style="text-align:center">
          <div style="font-size:1.3rem;font-weight:900;color:var(--navy)">{{ cat.player_count }}</div>
          <div style="font-size:.68rem;color:var(--text-muted)">Ø¨Ø§Ø²ÛŒÚ©Ù†</div>
        </div>
        <div style="text-align:center">
          <div style="font-size:1.3rem;font-weight:900;color:var(--teal)">{{ cat.coach_count }}</div>
          <div style="font-size:.68rem;color:var(--text-muted)">Ù…Ø±Ø¨ÛŒ</div>
        </div>
        <div style="text-align:center">
          <div style="font-size:1.1rem;font-weight:800;color:var(--amber)">{{ cat.monthly_fee|floatformat:0 }}</div>
          <div style="font-size:.68rem;color:var(--text-muted)">Ø´Ù‡Ø±ÛŒÙ‡ (Ø±ÛŒØ§Ù„)</div>
        </div>
      </div>

      <!-- Schedule pills -->
      {% if cat.schedules.all %}
      <div style="display:flex;flex-wrap:wrap;gap:.3rem;margin-bottom:.9rem">
        {% for sch in cat.schedules.all %}
        <span style="background:rgba(14,165,233,.1);color:var(--teal);border-radius:99px;padding:.2rem .65rem;font-size:.7rem;font-weight:600">
          {{ sch.get_weekday_display }} {{ sch.start_time|time:"H:i" }}
        </span>
        {% endfor %}
      </div>
      {% endif %}

      <!-- Actions -->
      <div style="display:flex;gap:.4rem;flex-wrap:wrap">
        <a href="{% url 'training:category-detail' cat.pk %}"
           class="btn btn-outline btn-sm" style="flex:1;justify-content:center">ğŸ‘ï¸ Ø¬Ø²Ø¦ÛŒØ§Øª</a>
        {% if request.user.is_technical_director or request.user.is_superuser %}
        <a href="{% url 'training:category-update' cat.pk %}"
           class="btn btn-navy btn-sm">âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´</a>
        <a href="{% url 'training:attendance-select' %}?cat={{ cat.pk }}"
           class="btn btn-amber btn-sm">ğŸ“… Ø­Ø¶ÙˆØ±</a>
        {% endif %}
      </div>
    </div>
  </div>
  {% endfor %}
</div>

{% else %}
<div class="card" style="text-align:center;padding:3rem">
  <div style="font-size:3rem;margin-bottom:1rem">ğŸ—‚ï¸</div>
  <h3 style="font-weight:800;margin-bottom:.5rem">Ù‡ÛŒÚ† Ø¯Ø³ØªÙ‡â€ŒØ§ÛŒ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯</h3>
  <p style="color:var(--text-muted);font-size:.875rem">
    {% if q %}Ù†ØªÛŒØ¬Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Â«{{ q }}Â» ÛŒØ§ÙØª Ù†Ø´Ø¯.
    {% else %}Ù‡Ù†ÙˆØ² Ù‡ÛŒÚ† Ø¯Ø³ØªÙ‡ Ø¢Ù…ÙˆØ²Ø´ÛŒ ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.{% endif %}
  </p>
  {% if request.user.is_technical_director or request.user.is_superuser %}
  <a href="{% url 'training:category-create' %}" class="btn btn-amber" style="margin-top:1rem">
    â• Ø§ÙˆÙ„ÛŒÙ† Ø¯Ø³ØªÙ‡ Ø±Ø§ Ø¨Ø³Ø§Ø²
  </a>
  {% endif %}
</div>
{% endif %}

{% endblock %}
